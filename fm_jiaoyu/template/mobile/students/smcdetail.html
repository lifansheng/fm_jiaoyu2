<!--
 * @Discription:  
 * @Author: Hannibal·Lee
 * @Date: 2020-02-14 16:41:20
 * @LastEditTime: 2020-03-07 17:36:35
 -->

 <!DOCTYPE html>
 <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
     <title>{$school['title']}</title>
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
     <meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes" />
     <link rel="stylesheet" href="{MODULE_URL}public/mobile/css/weixin.css">
     <script type="text/javascript" src="{MODULE_URL}public/mobile/js/jquery-1.11.3.min.js?v=4.9"></script>
 </head>
 <style type="text/css">
             .stu-info{
                 background-image: url('{OSSURL}public/mobile/img/bg@3x.png');
                 background-size: 100% 100%;
                 margin: 0;
                 padding-top: 2.5rem;
                 border-radius: 0;
                 width:100%;
                 height: 12rem;
                 text-align: center;
                 color:white;
             }
             .stu-info img{
                 width: 3rem;
                 height: 3rem;
             }
             .stu-info h4{
                 color:white;
                 font-size: 0.7rem;
                 margin-top: 0.1rem;
                 margin-bottom: 0.1rem;
             }
             .stu-info p{
                 color:white;
                 font-size: 0.5rem;
                 margin-bottom: 0.1rem;
             }
 
             .BigDiv{
                 display: flex; 
                 width: 100%;
                 flex-flow: row wrap;
             }
             .middleDiv{
                 width: 33%;
                 margin-top: 5%;
                 text-align: center;
             }
             .font1 {
                 font-size: 0.7rem;
                 color: #766a6a;
                 font-weight: bold;
                 padding: 0.1rem 0;
             }
             .font2 {
                 color: #00B7F3;
             }
             .s_name{
                 width: 100%; padding: 10px; text-align: center;border-bottom: 1px solid #ccc;
             }
             .act{
                 border-bottom: 2px solid #34afbe;
             }
 </style>
 <body >
     {if $_GPC['bj_id']}
     <div onclick="SelectStu()" style="z-index: 2000;position: fixed; color: #b52323; border: 1px solid; border-radius: 10px 0 0 10px; right: 0; top: 25px;">
         切换学生
     </div>
     {/if}
     <div class="stu-info">
         <img src="{if $student['icon']}{php echo tomedia($student['icon'])}{else}{php echo tomedia($school['spic'])}{/if}" style="border-radius: 50%">
         <h4 >{$student['s_name']}</h4>
         <p >{$bj['sname']}</p>
     </div>
     <div style="color: #766a6a; text-align: center;padding: 5px;">{php echo date("Y-m-d",$mcdata['createdate'])}检测情况</div>
     <div class="BigDiv" >
         <div class="middleDiv">
             <span class="font1">体温</span> <br>
             <span class="font2">{$mcdata['tiwen']} ℃</span>
         </div>
         {if keep_MC()}
         <div class="middleDiv">
             <span class="font1">口腔</span> <br>
             <span class="font2">{if $mcdata['mouth'] == 1}未见异常{else}异常{/if}</span>
         </div>
         <div class="middleDiv">
             <span class="font1">身高</span> <br>
             <span class="font2">{$mcdata['height']}cm</span>
         </div>
         <div class="middleDiv">
             <span class="font1">体重</span> <br>
             <span class="font2">{$mcdata['weight']}KG</span>
         </div>
         <div class="middleDiv">
             <span class="font1">左眼视力</span> <br>
             <span class="font2">{$mcdata['lefteye']}</span>
         </div>
         <div class="middleDiv">
             <span class="font1">右眼视力</span> <br>
             <span class="font2">{$mcdata['righteye']}</span>
         </div>
         <div class="middleDiv">
            <span class="font1">疱疹</span> <br>
            <span class="font2">{if $mcdata['herpes'] == 1}未见异常{elseif $mcdata['herpes'] == 2}异常{else}未检测{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">手掌疱疹</span> <br>
            <span class="font2">{if $mcdata['handHerpes'] == 1}未见异常{elseif $mcdata['handHerpes'] == 2}异常{else}未检测{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">指甲</span> <br>
            <span class="font2">{if $mcdata['nail'] == 1}未见异常{elseif $mcdata['nail'] == 2}异常{else}未检测{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">咳嗽</span> <br>
            <span class="font2">{if $mcdata['cough'] == 0}未检测{elseif $mcdata['cough'] == 1}未见异常{else}异常{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">外伤</span> <br>
            <span class="font2">{if $mcdata['trauma'] == 0}未检测{elseif $mcdata['trauma'] == 1}未见异常{else}异常{/if}</span>
        </div>
        {/if}
        {if !keep_MC()}
        <div class="middleDiv">
            <span class="font1">呕吐</span> <br>
            <span class="font2">{if $mcdata['vomit'] == 0}未检测{elseif $mcdata['vomit'] == 1}未见异常{else}异常{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">腹泻</span> <br>
            <span class="font2">{if $mcdata['diarrhea'] == 0}未检测{elseif $mcdata['diarrhea'] == 1}未见异常{else}异常{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">感冒</span> <br>
            <span class="font2">{if $mcdata['cold'] == 0}未检测{elseif $mcdata['cold'] == 1}未见异常{else}异常{/if}</span>
        </div>
        <div class="middleDiv">
            <span class="font1">头痛</span> <br>
            <span class="font2">{if $mcdata['headache'] == 0}未检测{elseif $mcdata['headache'] == 1}未见异常{else}异常{/if}</span>
        </div>
        {/if}
        {if $mcdata['issb'] == 1}
        <div class="middleDiv">
            <span class="font1">手掌照片</span> <br>
            <span class="font2"><img src="{$mcdata['handPhoto']}" style="width: 50px;height: 50px; border-radius: 50%;"></span>
        </div>
        <div class="middleDiv">
            <span class="font1">晨检照片</span> <br>
            <span class="font2"><img src="{$mcdata['userPhoto']}" style="width: 50px;height: 50px; border-radius: 50%;"></span>
        </div>
        <div class="middleDiv">
            <span class="font1">口腔照片</span> <br>
            <span class="font2"><img src="{$mcdata['mouthPhoto']}" style="width: 50px;height: 50px; border-radius: 50%;"></span>
        </div>
        {/if}
         
     </div>
     {if keep_MC()}
     <div style="text-align: center;margin: 0.5rem">
         <div id="echarts-pie-chart-mobilestumc" style="width: 100%;height:300px;"></div>
         <div id="echarts-pie-chart-tiwenmc" style="width: 100%;height:300px;"></div>
         <div id="echarts-pie-chart-eye" style="width: 100%;height:300px;"></div>
     </div>
     {/if}
 
     <div style="width: 100%; height: 100%; position: fixed;z-index: 2000; top: 0; display: none;" id="showmodal">
         <div style="position: absolute; background-color: rgba(0, 0, 0, 0.39); width: 100%; height: 100%;z-index: 1;" onclick="HideModal()">
         </div>
         <div style="position: absolute; background-color: white; width: 25%; height: 100%;min-height: 400px;right: -30%;z-index: 2; overflow-y: auto;" id="ShowItem">
             {loop $stulist $row}
             <div class="s_name  {if $row['id'] == $_GPC['sid']}act{/if}" onclick="gomcdetail(`{$row['id']}`,`{$row['bj_id']}`)">
                 {$row['s_name']}
             </div>
             {/loop}
         </div>
     </div>
     {if $_GPC['bj_id']}
     {php include $this->template('newfooter');}
     {/if}
 </body>
 </html>
 <script type="text/javascript" src="{MODULE_URL}public/mobile/js/jquery-1.11.3.min.js?v=4.9"></script>
 
 <script src=" https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
 <script src="{$_W['siteroot']}addons/fm_jiaoyu/public/web/js/start_chart_init.js"></script>	
 <script>
     function SelectStu(){
         $("#showmodal").show()
         $("#showmodal #ShowItem").animate({right:0},300)
     }
     function gomcdetail(sid,bj_id){
         location.href = `{php echo $this->createMobileUrl('smcdetail', array('schoolid' => $schoolid), true)}`+'&sid='+sid+'&bj_id='+bj_id;
     }
     function HideModal(){
         $("#showmodal #ShowItem").animate({right:'-30%'},300,function(){
             $("#showmodal").hide()
         })
     }
     //默认进入取一个学生的数据
     $(function(){
        let keep_MC = `{php echo keep_MC()}`
        if(keep_MC == 1){
            search()
        }
     })
     function search(){
         var sid = `{$mcdata['sid']}`
         $.ajax({
             url: "{php echo $this->createMobileUrl('smcdetail',array('op'=>'GetStuMcData','schoolid'=>$schoolid))}",
             type: "POST",
             data: {sid:sid},
             dataType: "json",
             success: function (datas) {
                let ds = PieOption['mobilestumc'];
                ds.legend.data = ['身高','体重'];
                ds.xAxis [0].data = datas.date;
                ds.series[0].data = datas.height;
                ds.series[1].data = datas.weight;
                var myChart = echarts.init($('#echarts-pie-chart-mobilestumc')[0]);
                myChart.setOption(ds);
                
                
                let eye = PieOption['mobilestumc'];
                eye.xAxis.data = datas.date;
                eye.legend.data = ['左眼','右眼'];
                eye.series[0].data = datas.lefteye;
                eye.series[0].name = '左眼';
                eye.series[1].data = datas.righteye;
                eye.series[1].name = '右眼';
                var myChart3 = echarts.init($('#echarts-pie-chart-eye')[0]);
                myChart3.setOption(eye);

                let tiwen = PieOption['tiwennum'];
                tiwen.xAxis.data = datas.date;
                tiwen.legend.data = ['体温'];
                tiwen.series[0].data = datas.tiwen;
                tiwen.series[0].name = '体温';
                tiwen.yAxis.max = 42;
                tiwen.yAxis.min = 35;
                var myChart2 = echarts.init($('#echarts-pie-chart-tiwenmc')[0]);
                myChart2.setOption(tiwen);
                 
             }
         });
     }
 </script>

<script>
var WeixinApi = (function () {
    return {
        imagePreview: imagePreview
    };
    "use strict";
    /**
        * 调起微信Native的图片播放组件。
        * 这里必须对参数进行强检测，如果参数不合法，直接会导致微信客户端crash
        *
        * @param {String} curSrc 当前播放的图片地址
        * @param {Array} srcList 图片地址列表
        */
    function imagePreview(curSrc, srcList) {
        if (!curSrc || !srcList || srcList.length == 0) {
            return;
        }
        WeixinJSBridge.invoke('imagePreview', {
            'current': curSrc,
            'urls': srcList
        });
    }
    return {
        version: "2.5",
        ready: wxJsBridgeReady,
        imagePreview: imagePreview
    };
})();

var srcList = new Array();


function wxImageShow(src) {
    WeixinApi.imagePreview(src, srcList);
}

$(function () {
    //给图片增加点击放大功能
    $(".middleDiv").find("img").each(function () {
        let src = $(this).attr("src");
        srcList.push(src);
        $(this).attr("onclick", "wxImageShow('" + src + "');");
    });
});	
</script>
