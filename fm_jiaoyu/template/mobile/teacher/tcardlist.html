<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<meta name="HandheldFriendly" content="true" />
<link rel="stylesheet" type="text/css" href="{OSSURL}public/mobile/css/new_yab1.css?v=1?v=1111" />
<script type="text/javascript" src="{MODULE_URL}public/mobile/js/jquery-1.10.1.min.js?v=4.9"></script>
{php echo register_jssdks();}
<style type="text/css">
.header { width: 100%; height: 50px; line-height: 50px; position: fixed; z-index: 1000; top: 0; left: 0; box-shadow: 0 0 2px 0px rgba(0,0,0,0.3),0 0 6px 2px rgba(0,0,0,0.15); } .header .l { width: 50px; height: 50px; line-height: 50px; color: white; position: absolute; left: 0; top: 0; } .header .m { width: 100%; height: 50px; line-height: 50px; text-align: center; color: white; font-size: 18px; } .header .r { width: 50px; height: 50px; line-height: 50px; position: absolute; right: 0; top: 0; } .mainColor { background: #06c1ae !important; } .header .l a { font-size: 18px; color: white; display: block; width: 100%; height: 100%; text-align: center; }
.add_link_box{
width:100%;position: absolute;left:0;top:60px;bottom:0;z-index: 9999;background-color:rgba(0,0,0,0.5);display: none}
.add_link_info_wrap{padding:0 10px;margin:0 auto;display: -webkit-box;-webkit-box-orient:vertical;-webkit-box-pack: center;-webkit-box-align: center;height:100%;}
.my_add_link_inner{width: 100%;height:190px;background-color: #fff;border-radius: 10px;padding: 10px 0;}
.my_add_link_inner h3{text-align: center;color:#666;}
.add_link_wrap{height:35px;line-height: 35px;overflow: hidden;padding: 10px; }
.my_link_title {width: 80px;float: left;color: #666666;}
.my_add_link_txt{height:35px;line-height: 35px;box-sizing: border-box;width:70%;outline: none;border:1px solid #dcdcdc;border-radius: 3px;float:left;}
.add_link_btn_wrap{padding: 10px;overflow:hidden;}
.add_link_btn_sure {float: left;width: 40%;height: 35px;line-height: 35px;background: #06c1ae;font-size: 16px;border-radius: 20px;color: #fff;border: none;padding: 0;margin: 0 5%;outline: none;}
#add_link_btn_cancel {background: #ffb24e;}
.link_title {text-align: center;color: #333333;font-size: 16px;margin-top: 2px;}
.main {margin: 10px 10px;box-shadow: 0px 0px 0px rgba(0,0,0,0);background: #FFF;padding: 0;border-radius: 10px;padding-bottom: 10px;}
.main_text a {cursor: pointer !important;text-decoration: underline !important;color: #0094ff;}
.main img {margin-top: 0px;}
.common_no_audit_status {background-color: initial;}
.baby_diary_img_list {margin-left: 5px;margin-top: 5px;padding-bottom: 10px;}
.baby_diary_img_listOther {margin-left: 0;margin-top: 10px;padding-left: 12px;}
.baby_diary_img_list li {width: 32.5%;height: 70px;overflow: hidden;box-sizing: border-box;padding: 2px;float: left;margin: 0;}
.notifyImgItem {width: 30.5% !important;position: relative;}
.btn_closeImg {position: absolute;width: 10px;top: 0;right: 4px;}
.F_div {right: 30px;bottom:75px}
.baby_diary_img_listOther {padding-left: 10px;border-bottom: 1px solid #f0f0f2;}
#notifyContent {padding: 10px;background-color: white;border: 1px solid #f0f0f2;}
.main_text p, .main_text a {display: inline-block;}
.main, .linkDataUrl {cursor: pointer !important;}
.linkDataUrl {text-decoration: underline !important;}
.pv-img {position: relative;}
.imgDesc {position: absolute;right: 15px;height: 20px;line-height: 20px;font-size: 16px;color: white;text-align: right;z-index: 99;}
p img {margin: 10px 0 !important;} 
.slide_left_menu_bg.show_menu_bg {display: block;-webkit-animation-name: fadeIn;animation-name: fadeIn;-webkit-animation-duration: 600ms;animation-duration: 600ms;-webkit-animation-fill-mode: both;/* animation-fill-mode: both; */}
.slide_left_menu_bg_other.show_menu_bg {display: block;-webkit-animation-name: fadeIn;animation-name: fadeIn;-webkit-animation-duration: 600ms;animation-duration: 600ms;-webkit-animation-fill-mode: both;/* animation-fill-mode: both; */}
.slide_left_menu_bg {width: 100%;z-index: 998;background: rgba(0, 0, 0, 0.5);position: fixed;min-height: 100%;top: 0;left: 0;zoom: 1;overflow: hidden;display: none;height: 100%;z-index: 1000;overflow-y: scroll;}
.slide_left_menu_bg_other {width: 100%;z-index: 998;background: rgba(0, 0, 0, 0.5);position: fixed;min-height: 100%;top: 0;left: 0;zoom: 1;overflow: hidden;display: none;height: 100%;
z-index: 1000;overflow-y: scroll;display: none;}
.slide_left_menu {width: 50%!important;right: 0;background-color: #fff;z-index: 999;min-height: 100%;position: absolute;}
.slide_left_menu_ul_other {width: 100%;border: 1px solid #ccc;border-left: none;border-right: none;box-sizing: border-box;padding: 0 10px;}
.slide_left_menu_ul_other li {height: 50px;line-height: 50px;border-bottom: 1px solid #ccc;font-size: 16px;width: 100%;box-sizing: border-box;padding: 0 10px 0 10px;overflow: hidden;
position: relative;}
.slide_left_menu_ul_other li.act {background: url({OSSURL}public/mobile/img/be_choose_icon.png) right center no-repeat;background-size: 16px;background-origin: content-box;-moz-background-origin: content-box;-webkit-background-origin: content-box;}
.slide_left_menu_ul li.act {background: url({OSSURL}public/mobile/img/be_choose_icon_02.png) right center no-repeat;background-size: 16px;background-origin: content-box;-moz-background-origin: content-box;-webkit-background-origin: content-box;}
.slide_left_menu_ul_other li:last-of-type {border-bottom: none;}
.slide_left_menu_ul_other li .user_img {width: 50px;height: 50px;position: absolute;left: -5px;top: 0;box-sizing: border-box;padding: 10px;}
.slide_left_menu_ul_other li .user_img img {width: 100%;height: 100%;border-radius: 50%;}
.slide_left_menu_ul_other li .change_user {width: 40px;height: 100%;position: absolute;right: 0;top: 0;background: url({OSSURL}public/mobile/img/be_choose_icon.png) center no-repeat;background-size: 30px;}
.slide_left_menu_til {height: 40px;line-height: 40px;box-sizing: border-box;padding: 0 40px 0 15px;position: relative;font-size: 16px;}
.slide_left_menu_ul {width: 100%;border: 1px solid #ccc;border-left: none;border-right: none;box-sizing: border-box;padding: 0 10px;}
.slide_left_menu_ul li {height: 50px;line-height: 50px;/*border-bottom: 1px solid #ccc;*/font-size: 16px;width: 100%;box-sizing: border-box;padding: 0 10px 0 50px;overflow: hidden;
position: relative;}
.hederRightBox {width: 21px;height: 100%;display: inline-block;position: absolute;right: 20px;}
.hederRightBox a {width: 100%;height: 21px;display: inline-block;position: absolute;top: 50%;transform: translateY(-50%);-webkit-transform: translateY(-50%);-moz-transform: translateY(-50%);-ms-transform: translateY(-50%);-o-transform: translateY(-50%);}
.Tip_usertype {height: 20px;background: #30c6e1;color: white;display: -webkit-box;display: -moz-box;display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-box-align: center;-moz-box-align: center;-ms-flex-align: center;-webkit-align-items: center;align-items: center;font-size: 11px;margin-left: 5px;padding: 0 4px;border-radius: 5px;}
.audit_statusNew, .audit_statusPass, .audit_statusPassReject {width: 50px;height: 20px;position: absolute;top: 0;right: 0;font-size: 11px;display: -webkit-box;display: -moz-box;
display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-box-align: center;-moz-box-align: center;-ms-flex-align: center;-webkit-align-items: center;align-items: center;
-webkit-box-pack: center;-moz-box-pack: center;-ms-flex-pack: center;-webkit-justify-content: center;justify-content: center;border-top-right-radius: 10px;border-bottom-left-radius: 10px;}
.audit_statusPass {background-color: #cccccc;color: #333333;}
.audit_statusNew {background-color: #ff9f22;color: white;}
.TopQuickInfo{width:calc(100% - 20px);height: 80px;background-color:white;margin-left: 10px;border-radius: 10px;box-shadow: 4px 3px 10px 0px #d4d4d4;position: relative;}
.TopToday{font-size: 20px;font-weight: bold;position: relative;}
.TypeColor{color: #ffb24e;}
.CheckCardImg{ position: absolute; right: 10px; margin-top: 5px;}
.ImgTips{
	float:left;
	height: 100%;
	width:calc(100% - 130px);
	font-size: 13px;
	font-weight: 400;
	margin-left: 10px;
	padding-top: 5px;
}
.manual_student_list_search {padding: 10px;box-sizing: border-box;width: 98%;margin-top: 62px;margin-bottom: 8px;left: 5px;height: 42px;border: 1px solid #d4d4d4;position: relative;background-color: #fff;border-radius: 6px;}
.manual_student_list_search .search_text {border: none;height: 22px;line-height: 22px;font-size: 14px;box-sizing: border-box;width: 100%;padding-right: 30px;}
.manual_student_list_search .search_btn {width: 22px;height: 22px;background: url({OSSURL}public/mobile/img/manual_search_icon.png) no-repeat center;background-size: 22px;position: absolute;right: 10px;
top: 10px;}
</style>
{php include $this->template('port');}
{php include $this->template('face');}
<div id="BlackBg" class="BlackBg"></div>
<div class="header mainColor">
	<div class="l" id="titlebar"><a class="backOff" style="background:url({OSSURL}public/mobile/img/ic_arrow_left_48px_white.svg) no-repeat;background-size: 55% 55%;background-position: 50%;" href="javascript:history.go(-1);"></a></div>
	<div class="m"><a><span style="font-size: 18px">{$nowbj['sname']}</span></a></div>
	<div class="r">
        <a href="javascript:;" class="choice_baby">
            <img style="height: 30px;margin-top:10px" src="{OSSURL}public/mobile/img/selectMean.png" class="img-responsive">
        </a>
	</div>
</div>
<title>{$school['title']}</title>
</head>
<body>
<div class="All">  
	<div class="manual_student_list_search">
		<input type="search" id="search" value="" placeholder="请输入学生姓名" class="search_text">
		<div class="search_btn" onclick="search();"></div>
	</div>     
	<div class="top_head_blank" style="height:0px"></div>	
    <div class="TopQuickInfo" >
		<div style="width: 30% ;height: 100%;float: left;display: flex;flex-direction: column;justify-content: space-around;text-align: center;" onclick="SelectType('-1')">
			<div class="TopToday {if $_GPC['ctype'] == -1} TypeColor {/if}"> 不限制 <br/> <span style="color:#30c6e1;"> {$AllNum} </span> </div>
		</div>
		<div style="width: 30% ;height: 100%;float: left;display: flex;flex-direction: column;justify-content: space-around;text-align: center;" onclick="SelectType(1)">
			<div class="TopToday {if $_GPC['ctype'] == 1} TypeColor {/if}"> 已上传 <br/> <span style="color:#30c6e1;"> {$HasBdNum} </span> </div>
		</div>
		<div style="width: 30% ;height: 100%;float: left;display: flex;flex-direction: column;justify-content: space-around;text-align: center;" onclick="SelectType(2)">
			<div class="TopToday {if $_GPC['ctype'] == 2} TypeColor {/if}"> 未上传 <br/> <span style="color:#30c6e1;"> {$HasNoBdNum} </span> </div>
		</div>
	</div>
	<div class="listContent">
		<div id="search_data" style="display: none;"></div>
		{loop $list $key $v}
        <li class="main" time="{$key}" ctype="{$_GPC['ctype']}" style="display: block;" id="hide_{$v['id']}"  >
			<div class="cutting"></div>
			<div class="notifyTopBox" onclick="showUploadImg(this,`{$v['id']}`)">
				<div class="notifyTopLeft">
					<img src="{php echo tomedia($v['icon']) ? tomedia($v['icon']) : tomedia($school['spic'])}" class="teacherImgError">
				</div>
				<div class="notifyTopRight">
					<div class="notifyTopRightTopBox" style="font-size: 12px;font-weight: inherit;">
						<span class="JobTeacherBox" >姓名：{$v['s_name']}</span>
						{if $v['sex'] == 1}
						<span class="Tip_usertype">性别：男</span>
						{else}
						<span class="Tip_usertype" style="background-color: #ea4444;">性别：女</span>
						{/if}
					</div>
					<div class="notifyTopRightTopBox" style="font-size: 12px;font-weight: inherit;color:gray">
                        {if $v['idcard']}
						<span>卡号：{$v['idcard']}</span>
						{else}
						<span id="changeidcard_{$v['id']}">未上传</span>
						{/if}
						<div class="CheckCardImg" id="showfacetext_{$v['id']}">查看人脸信息</div>    
                    </div>
				</div>
			</div>
			<input type="hidden" id="bigImage" name="bigImage"/>
			<div style="width: 100%; display: none;padding:5px 10px;overflow: hidden;margin-top: 10px;box-sizing: border-box;" id="showimg_{$v['id']}"  >
				<img {if $v['spic']} src="{php echo tomedia($v['spic']) }" {else} src="{MODULE_URL}public/mobile/img/insertImage.png"{/if} onclick="uploadImg(this,`{$v['id']}`);"   style="width: 80px;height: 80px; float:left;margin-left: 30px; ">
				<div class="ImgTips">
					<div style="margin-bottom:5px;">点击图片即可上传人脸照片</div>
					<div style="color:gray ;">请尽量上传光线充足、无强光直射、清晰的正面人脸照片</div>
				</div>
			</div>
		</li>
		{/loop}	
	</div>
	<div class="clear"></div>	
	<div class="slide_left_menu_bg">
		<div class="slide_left_menu">
			<div class="slide_left_menu_til">班级列表</div>
			<ul class="slide_left_menu_ul">
			<?php $bjlistsss = array();?>
				{loop $bjlists $row}
					{if !in_array($row['sid'], $bjlistsss)}
					<?php $bjlistsss[] = $row['bj_id'];?>
						<li onclick="isSelect({$row['sid']});" {if $bj_id == $row['sid']}class="act"{/if}><div style="margin-left: -47px;font-size: 13px;">{$row['sname']}{if $row['info']}<span style="color:red;">{$row['info']}</span>{/if}</div></li>
					{/if}
				{/loop}
			</ul>
		</div>
	</div>	
</div>
</body>
</html>
<script src="{OSSURL}public/mobile/js/common.js?v=1717"></script>
<!-- <script src="{OSSURL}public/mobile/js/scroll.muti.common.js?v=1717"></script> -->
<script src="{MODULE_URL}public/mobile/js/scroll_remaster.js "></script>
<script type="text/javascript">
	$(".choice_baby").on("click", function(e) {
		e.stopPropagation();
		$(".slide_left_menu_bg").addClass("show_menu_bg");
	});
	$(".slide_left_menu_bg").on("click", function() {
		$(this).removeClass("show_menu_bg");
	});
	function showUploadImg(obj,id){
		// let this_img = $(obj).parent().parent().parent().parent().find('#showimg_'+id);
		let this_img = $('#showimg_'+id);
		$(this_img).slideToggle(200,function(){
			const this_word = $('#showfacetext_'+id).text();
			if(this_word === '查看人脸信息'){
				$('#showfacetext_'+id).text('收起人脸信息')
			}else{
				$('#showfacetext_'+id).text('查看人脸信息')
			}
		});
	}
	function SelectType(type){
		window.location.href = "{php echo $this->createMobileUrl('tcardlist', array('schoolid' => $schoolid, 'bj_id' => $bj_id), true)}"+"&ctype="+type;
	}
	function isSelect(bjid){
		jTips("数据加载中！···");
		location.href = "{php echo $this->createMobileUrl('tcardlist', array('schoolid' => $schoolid,'ctype'=>-1), true)}"+ '&bj_id=' + bjid;
	}

	function search() {
		jTips('查询中..');
		var search = $("#search").val();
		$.ajax({
			type: "POST",
			url: "{php echo $this->createMobileUrl('techerajax', array('op' => 'search_stu_card_info'))}",
			dataType: "json",
			data: {
				search: search,
				bj_id: "{$bj_id}",
				schoolid:"{$schoolid}"
			},
			success: function(datas) {
				let data = datas.data;
				let html = '';
				if (datas.result == true) {
					jTips(datas.msg);
					for(var i = 0; i < data.length; i++){
						html +=`<li class="main" style="display:block">
								<div class="cutting"></div>
								<div class="notifyTopBox">
									<div class="notifyTopLeft">
										<img src="${data[i].icon}" class="teacherImgError">
									</div>
									<div class="notifyTopRight">
										<div class="notifyTopRightTopBox" style="font-size: 12px;font-weight: inherit;">
											<span>${data[i].s_name}</span>
											<div class="Tip_usertype">手机号：${data[i].mobile}</div>
										</div>
										<div class="notifyTopRightTopBox" style="font-size: 12px;font-weight: inherit;color:gray">
											<div id="changeidcard_${data[i].id}">${data[i].idcard}</div>
											<div class="CheckCardImg" onclick="showUploadImg(this,${data[i].id})">查看人脸信息</div>
										</div>
									</div>
								</div>
								<input type="hidden" id="bigImage" name="bigImage"/>
								<div style="width: 100%; display: none;padding:5px 10px;overflow: hidden;margin-top: 10px;box-sizing: border-box;" id="showimg_${data[i].id}"  >
									<img src="${data[i].spic}" onclick="uploadImg(this,${data[i].id});"   style="width: 80px;height: 80px; float:left;margin-left: 30px; ">
									<div class="ImgTips">
										<div style="margin-bottom:5px;">点击图片即可上传人脸照片</div>
										<div style="color:gray ;">请尽量上传光线充足、无强光直射、清晰的正面人脸照片</div>
									</div>
								</div></li>`;
					}
					html += `<div class="top_head_blank" style="height: 18px;color: #8c8888;text-align: center;">以上为搜索结果</div>`;
					$("#search_data").show()
					$("#search_data").html(html)
				} else {
					jTips(datas.msg);
				}
			}
		});
	}

    // 底部加载更多
	new Scroll_load({
		"limit": "0",
		"pageSize": 10,
		"ajax_switch": true,
		"ul_box": ".listContent",
		"li_item": ".listContent .main",
		'param' : ['time','ctype'],
		"ajax_url": "{php echo $this->createMobileUrl('tcardlist', array('schoolid' => $schoolid, 'bj_id' => $bj_id,'op'=>'scroll_more'), true)}",
		"page_name": "teacher_notify",
		"after_ajax": function () {}
	}).load_init();
</script>
{php include $this->template('newfooter');} 
<script>
var images = {
	localId: [],
	serverId: []
};
function uploadImg(node,id){
	wxChooseImage(id);
}
/**
 * 微信选择图片
 */
 function wxChooseImage(id){
	wx.chooseImage({
		success: function (res) {
			images.localId = res.localIds;
			var obj=new Image();
			obj.src=res.localIds[0];
			imagesUploadWx(id);
		}
	});
};
function imagesUploadWx(id) {
  wx.uploadImage({
	localId: images.localId[0],
	isShowProgressTips:1,//// 默认为1，显示进度提示
	success: function (res) {
		$("#bigImage").val(res.serverId);
		saveImage(id);
	},
	fail: function (res) {
	  alert(JSON.stringify(res));
	}
  });
};
function saveImage(id) {
	var url = "{php echo $this->createMobileUrl('indexajax',array('op'=>'ChangeCardSpic','schoolid'=>$schoolid,'weid'=>$weid))}";
	var submitData = {
		bigImage:$("#bigImage").val(),
		id:id,
		bj_id:`{$bj_id}`,
	};
	$.post(url, submitData, function(data) {
		if (data.result) {
			jTips(data.msg);
			$("#hide_"+id).hide()
		} else {
			jTips(data.msg);
		}
	},'json');
}
</script>