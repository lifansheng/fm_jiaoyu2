{template 'public/header'}
{template 'public/comhead'}
<link rel="stylesheet" href="//apps.bdimg.com/libs/jqueryui/1.10.4/css/jquery-ui.min.css">
<style>
    .pageBackMask{ position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; pointer-events: none; }
    .container_box{ background-color: white; box-shadow: 0 0 1px 1px #9c9c9c; }
    .img_container_list .container_box{ background-color: white !important;}
    .editActive{ box-shadow: 0 0 1px 2px #20decf !important; }
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; }
    input[type="number"]{ -moz-appearance: textfield; }
    body, div, span, header, footer, nav, section, aside, article, ul, dl, dt, dd, li, a, p, h1, h2, h3, h4, h5, h6, i, b, textarea, button, input, select, figure, figcaption { padding: 0; margin: 0; list-style: none; font-style: normal; text-decoration: none; border: none; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; }
    .container_score .scoreItem img { height: 50%; }
    .container_score .scoreItem span { height: .1rem; border-radius: 50%; -webkit-border-radius: 50%; -moz-border-radius: 50%; -ms-border-radius: 50%; -o-border-radius: 50%; margin-left: 5%; }
    .container_score .scoreItem .scoreItemTxt { border: none; }
    .tpl_page{ width: 750px; height: 530px; transform: scale(1); transform-origin: center center;overflow: hidden; }
    .show_yulan_img{ display: none }
    .leftArrow{ position: absolute; }
    .leftArrow:before,.leftArrow:after{ position: absolute; content: ''; border-top: 10px transparent dashed; border-left: 10px transparent dashed; border-bottom: 10px transparent dashed; border-right: 10px #fff solid; }
    .leftArrow:before{ border-right: 10px #d2d2d2 solid; }
    .leftArrow:after{ left: 1px; /*覆盖并错开1px*/ border-right: 10px #fff solid; }
    .titleDiv{ line-height: 30px;font-size: 14px;font-weight: 300;color: #000000; }
    .EditBoxTitle{ position: relative; }
    .EditBoxTitle:after{ content:''; height: 1px; width: 90%; left: 5%; position: absolute; bottom: 8px; background-color: #d4d1d6; }
    .input-group .input-group-addon { border-color: #e7e7eb; border-radius: 0; padding: 5px 10px; color: #4c4c4c; background-color: #f5f5f5; }
    .toggleConSet{ display: none; }
    #Modal10 .modal-dialog { position: absolute; left: 30%; top: 20%; }
    .CheckReset .defaultInfo{ height: auto; overflow:hidden; }
    .CheckReset.Fail .defaultInfo{ height: 0; }
    .CheckReset .failInfo{ height: 0; overflow:hidden; }
    .CheckReset.Fail .failInfo{ height: auto; }
    .CheckReset.Fail  input{ border:1px solid red; }
    .savePage{display: inline-block;padding:2px 10px;font-size: 14px;border-color: #41c9c0;}
    .cancelPage{padding:3px 10px;font-size: 14px;}
    .Op_btnBox{margin-bottom: 10px;}
    .Op_btnBox>span{padding:3px 10px;font-size: 14px;}
    .ExInfoBox{font-size: 13px;line-height: 20px;margin-top: 20px;}
    .BoxTitle{font-weight: bold;}
    .BoxConName{width:90px;text-align: right;}
    .BoxConName~div{width: calc(100% - 100px);}
    .modal-dialog .modal-footer .btn, .we7-modal-dialog .modal-footer .btn{
        min-width: 10px !important;
    }
</style>
<div class="main" style="height: calc(100vh - 130px);position: relative;min-height: 650px;" >
    <div class="panel panel-info" style="width: 420px;height: 100%;float: left;" >
        <div class="panel-heading">
            <span>操作区</span>
            <span style="float: right;">
                <span class="btn btn-primary savePage" onclick="ShowHtml()"> <i class="fa fa-save "></i> 保存</span>
                <span class="btn btn-default cancelPage"> <i class="fa fa-mail-reply"></i> <a href="{php echo $this->createWebUrl('manualmuban', array('op' => 'checkpage','id'=> $_GPC['mid'],'schoolid' => $schoolid))}">退出编辑</a> </span>
            </span>
        </div>
        <div class="panel-body" >
            <div style="padding:10px;display: flex;margin-bottom: 10px; ">
                <div class="titleDiv"> 名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称： </div>
                <div>
                    <input class="form-control" id="pagetitle" type="text" value="{$mubanpage['title']}">
                </div>
            </div>
            
            <div style="padding:10px;display: flex;margin-bottom: 10px; ">
                <div class="titleDiv"> 选择类型： </div>
                <div>
                    <select style="margin-right:15px;width: 175px;" id="pagetype" class="form-control">
                        <option value="0" {if $mubanpage['pagetype'] == 0}selected{/if}>详情页</option>
                        <option value="1" {if $mubanpage['pagetype'] == 1}selected{/if}>封面</option>
                        <option value="2" {if $mubanpage['pagetype'] == 2}selected{/if}>尾页</option>
                    </select>
                </div>
            </div>

            <div style="padding:10px;display: flex;margin-bottom: 10px; ">
                <div class="titleDiv"  > 缩&nbsp;略&nbsp;&nbsp;图： </div>
                <div >
                    {php echo tpl_form_field_images('thumb',$mubanpage['thumb'])}
                </div>
            </div>

            <div style="padding:10px;display: flex;margin-bottom: 10px; ">
                <div class="titleDiv"  > 背景图片： </div>
                <div >
                    {php echo tpl_form_field_images('pageBackImg')}
                </div>
            </div>
            <div class="Op_btnBox" >
                <span class="btn btn-default"  onclick="javascript:$('#Modal10').modal('toggle');CleanModal()"> <i class="fa fa-plus "></i> 添加容器</span>
                <span class="btn btn-default"  onclick="ShowHtml()"> <i class="fa fa-search"></i> 查看预览</span>
            </div>
            <div class="ExInfoBox" >
                <div class="BoxTitle">
                    说明：
                </div>
                <div style="text-indent: 26px;display: flex;">
                    <span>可对容器调整位置，拖动 “</span>
                    <span class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" draggable="false" style="z-index: 90;position: relative;cursor:unset"></span> ”
                    可调整容器大小。
                </div>
                <div style="text-indent: 26px;">
                    图片容器实际层级位于背景图片下层。编辑时为方便选取对层级进行了调整，调整完毕后请点击“查看预览”按钮审查实际效果。
                </div>
            </div>
            <div class="ExInfoBox">
                <div class="BoxTitle">
                    容器介绍：
                </div>
                <div>
                    <div style="display: flex;">
                        <div class="BoxConName"> 图片容器： </div>
                        <div> 容器内可填充图片，图片可缩放并调整位置 </div>
                    </div>
                    <div style="display: flex;">
                        <div class="BoxConName"> 文本容器： </div>
                        <div > 容器内可填写文字，不得超过最大字数，可设置评语分类快速选择评语 </div>
                    </div>
                    <div style="display: flex;">
                        <div class="BoxConName"> 展示容器： </div>
                        <div> 可选择展示内容，容器内文字不可编辑 </div>
                    </div>
                    <div style="display: flex;">
                        <div class="BoxConName"> 单选容器： </div>
                        <div> 每个容器可设置一组单选项，选项内容可设置文字或图片 </div>
                    </div>
                    <div style="display: flex;">
                        <div class="BoxConName"> 图标容器： </div>
                        <div> 每个容器可设置展示考勤统计或晨检统计，可设置统计时间区间 </div>
                    </div>
                    <div style="display: flex;">
                        <div class="BoxConName"> 视频容器： </div>
                        <div> 每个容器可上传一个视频，展示内容为对应二维码，扫描二维码可观看视频 </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel panel-info" style="height: 100%;margin-left: 20px;float: left;width: calc(100% - 440px);">
        <div class="panel-heading">编辑区</div>
        <div class="panel-body" >
            <div style="display: flex;" >
                <!-- 页面展示区 -->
                <div style="padding:20px 20px 20px 40px;width: 530px;">
                    <div class="tpl_page" id="tpl_page" style="width: 750px; height: 530px; transform: scale(1); transform-origin: center center; display: block;background-color: #ccc;" >
                        <!-- <div class="pageBackMask" id="pageBackMask" style="background: url({OSSURL}public/web/images/pagemuban1.png) center center / 100% 100% no-repeat;"> -->
                        <div class="pageBackMask" id="pageBackMask" >
                        </div>
                        <div class="img_container_list" style="z-index: 16;position: absolute;">
                        </div>
                        <div class="title_container_list" style="position:absolute;z-index:16;">
                        </div>
                        <div class="score_container_list" style="position:absolute;z-index:16;">
                        </div>
                        <div class="txt_container_list" style="position:absolute;z-index:16;">
                        </div>
                        <div class="show_container_list" style="position:absolute;z-index:16;">
                        </div>
                        <div class="chart_container_list" style="position:absolute;z-index:16;">
                        </div>
                        <div class="video_container_list" style="position:absolute;z-index:16;">
                        </div>
                    </div>
                </div>
                <!-- 编辑区 -->
                <div style="flex: 1;padding:20px 257px" >
                    <div id="EditBox" style="width: 470px;border-radius: 5px;border:1px solid #d2d2d2;position: relative;box-shadow: 2px 1px 8px #d6d6d6;display: none;" >
                        <i class="leftArrow" style="left: -20px; top: 28px;"></i>
                        <div style="width: 100%;height: 100%;padding:20px" >
                            <div class="EditBoxTitle" style="height: 40px;font-size: 16px;margin-bottom: 20px;line-height: 20px;">设置容器
                                <span style="padding: 4px 12px;font-size: 12px;" class="btn btn-danger" onclick="RemoveContainer()">移除容器</span>
                                <span style="padding: 4px 12px;font-size: 12px;" class="btn btn-primary" onclick="CopyContainer()">复制</span>
                            </div>
                            <form id="EditContainer">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">定位</label>
                                    <div class="col-sm-5">
                                        <div class="input-group">
                                            <span class="input-group-addon">top</span>
                                            <input type="number" class="form-control" id="ActItem-top" data-type="Position" data-target="top"/>
                                            <span class="input-group-addon">px</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="input-group">
                                            <span class="input-group-addon">left</span>
                                            <input type="number" class="form-control" id="ActItem-left" data-type="Position" data-target="left" />
                                            <span class="input-group-addon">px</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">大小</label>
                                    <div class="col-sm-5">
                                        <div class="input-group">
                                            <span class="input-group-addon">宽</span>
                                            <input type="number" class="form-control" id="ActItem-width"  data-type="Client" data-target="width" value="" />
                                            <span class="input-group-addon">px</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="input-group">
                                            <span class="input-group-addon">高</span>
                                            <input type="number" class="form-control"  id="ActItem-height" data-type="Client" data-target="height"  value="" />
                                            <span class="input-group-addon">px</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="ShowTxtContainer" style="display: none;">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">字体大小</label>
                                        <div class="col-sm-5">
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="ActItem-fontSize" data-type="Client" data-target="fontSize"/>
                                                <span class="input-group-addon">px</span>
                                            </div>
                                        </div>
                                        <label class="col-sm-2 control-label">字体行高</label>
                                        <div class="col-sm-5">
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="ActItem-lineHeight" data-type="Client" data-target="lineHeight"/>
                                                <span class="input-group-addon">px</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 col-md-2 control-label ">文字颜色</label>
                                        <div class="col-sm-8">
                                            <script type="text/javascript">
                                                $(function(){
                                                    $("#EditFontColor .colorpicker").each(function(){
                                                        var elm = this;
                                                        util.colorpicker(elm, function(color){
                                                            setContainerData('Client',color.toHexString(),'fontColor')
                                                            $(elm).parent().prev().prev().val(color.toHexString());
                                                            $(elm).parent().prev().css("background-color", color.toHexString());
                                                        });
                                                    });
                                                    $("#EditFontColor .colorclean").click(function(){
                                                        $(this).parent().prev().prev().val("");
                                                        $(this).parent().prev().css("background-color", "#FFF");
                                                    });
                                                });
                                            </script>
                                            <div class="row row-fix" id="EditFontColor">
                                                <div class="col-xs-8 col-sm-8" style="width: 300px;">
                                                    <div class="input-group">
                                                        <input class="form-control" type="text" id="ActItem-fontColor"  name="headcolor" data-type="Client" data-target="fontColor" placeholder="请选择颜色" >
                                                        <span class="input-group-addon" id="ActItem-backGround" data-type="Client" data-target="backGround" style="width:35px;border-left:none;"></span>
                                                        <span class="input-group-btn">
                                                            <button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>
                                                            <button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group" id="MaxSize">
                                        <label class="col-sm-2 control-label">最大字数</label>
                                        <div class="col-sm-3">
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="ActItem-maxLength" data-type="Client" data-target="maxLength"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group" id="placeholder">
                                        <label class="col-sm-2 control-label">文字提示</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="ActItem-placeholder" data-type="Client" data-target="placeholder"/>
                                        </div>
                                    </div>

                                    <div class="form-group" id="videodescription">
                                        <label class="col-sm-2 control-label">文字描述</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="ActItem-description" data-type="Client" data-target="description"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group " id="chart" style="display: none;">
                                    <div class="form-group">
                                        <label class="col-xs-12 col-sm-3 col-md-2 control-label">背景颜色</label>
                                        <div class="col-sm-8">
                                            <script type="text/javascript">
                                                $(function(){
                                                    $("#EditChartBgColor .colorpicker").each(function(){
                                                        var elm = this;
                                                        util.colorpicker(elm, function(color){
                                                            setContainerData('Client',color.toHexString(),'ChartBgColor')
                                                            $(elm).parent().prev().prev().val(color.toHexString());
                                                            $(elm).parent().prev().css("background-color", color.toHexString());
                                                        });
                                                    });
                                                    $("#EditChartBgColor .colorclean").click(function(){
                                                        $(this).parent().prev().prev().val("");
                                                        $(this).parent().prev().css("background-color", "#FFF");
                                                    });
                                                });
                                            </script>
                                            <div class="row row-fix" id="EditChartBgColor">
                                                <div class="col-xs-8 col-sm-8" style="width: 300px;">
                                                    <div class="input-group">
                                                        <input class="form-control" type="text" id="ActItem-ChartBgColor"  name="headcolor" data-type="Client" data-target="ChartBgColor" placeholder="请选择颜色" >
                                                        <span class="input-group-addon" id="ActItem-BgColor" data-type="Client" data-target="BgColor" style="width:35px;border-left:none;"></span>
                                                        <span class="input-group-btn">
                                                            <button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>
                                                            <button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">类型</label>
                                        <div class="col-sm-4">
                                            <select style="margin-right:15px;" id="CheckChartType" class="form-control cleanTarget">
                                                <option value="1">考勤</option>
                                                <option value="2">晨检</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">时间范围</label>
                                        <div class="col-sm-8">
                                            {php echo tpl_form_field_daterange('CheckCreatetime', array('start' => date('Y-m-d', TIMESTAMP - 86399*7), 'end' => date('Y-m-d', TIMESTAMP + 86399*7)));}
                                        </div>
                                    </div>

                                    <div class="form-group" id="CheckChartBox" style="display: none;">
                                        <label class="col-sm-2 control-label">展示内容</label>
                                        <div class="col-sm-8" id="CheckChartMenu">
                                            <input type="checkbox" name="CheckChartMenu[]" value="height" data-type="Client" data-target="chartMenu">身高
                                            <input type="checkbox" name="CheckChartMenu[]" value="weight" data-type="Client" data-target="chartMenu">体重
                                            <input type="checkbox" name="CheckChartMenu[]" value="tiwen" data-type="Client" data-target="chartMenu">体温
                                            <input type="checkbox" name="CheckChartMenu[]" value="lefteye" data-type="Client" data-target="chartMenu">左眼
                                            <input type="checkbox" name="CheckChartMenu[]" value="righteye" data-type="Client" data-target="chartMenu">右眼
                                        </div>
                                    </div>

                                </div>
                                <!-- <div class="form-group" id="JustShowContainer" style="display: none;">
                                    <label class="col-sm-2 control-label">展示内容</label>
                                    <div class="col-sm-4">
                                        <select style="margin-right:15px;" id="ActItem-showInfo" data-type="Client" data-target="showInfo" class="form-control cleanTarget">
                                            <option value="schoolTitle">学校名称</option>
                                            <option value="stuClass">学生班级</option>
                                            <option value="stuName">学生姓名</option>
                                        </select>
                                    </div>
                                </div> -->
                                <div id="ScoreItemData">
                                </div>
                                <div id="ScoreImg0" class="scoreimgdata form-group" data-target-index="0" style="display: none;"><span style="display: block;float: left;margin-right: 15px; margin-left: 50px; line-height: 35px;">图标1</span>
                                    {php echo tpl_form_field_images('ScoreImg0')}
                                </div>
                                <div id="ScoreImg1" class="scoreimgdata form-group" data-target-index="1" style="display: none;"><span style="display: block;float: left;margin-right: 15px; margin-left: 50px; line-height: 35px;">图标2</span>
                                    {php echo tpl_form_field_images('ScoreImg1')}
                                </div>
                                <div id="ScoreImg2" class="scoreimgdata form-group" data-target-index="2" style="display: none;"><span style="display: block;float: left;margin-right: 15px; margin-left: 50px; line-height: 35px;">图标3</span>
                                    {php echo tpl_form_field_images('ScoreImg2')}
                                </div>
                                <div id="ScoreImg3" class="scoreimgdata form-group" data-target-index="3" style="display: none;"><span style="display: block;float: left;margin-right: 15px; margin-left: 50px; line-height: 35px;">图标4</span>
                                    {php echo tpl_form_field_images('ScoreImg3')}
                                </div>
                                <div id="ScoreImg4" class="scoreimgdata form-group" data-target-index="4" style="display: none;"><span style="display: block;float: left;margin-right: 15px; margin-left: 50px; line-height: 35px;">图标5</span>
                                    {php echo tpl_form_field_images('ScoreImg4')}
                                </div>
                                
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" style="min-width: 600px!important;" id="Modal10" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >
	<div class="modal-dialog" >
		<div class="modal-content" style="border-radius: 20px;">
			<div class="modal-header">
				<h4 class="modal-title" id="modal-title-kc" style="text-align:center;color:#333;font-size: 17px;">添加容器</h4>
			</div>
			<div class="modal-body form_paike_boxs" style="width: 100%;padding: 34px;max-height: 530px;">
				<form>
					<div class="form-group">
						<label class="col-sm-2 control-label"> <span style="color:red">*</span> 容器类型</label>
						<div class="col-sm-4">
                            <select style="margin-right:15px;" id="containerType" class="form-control">
								<option value="square">方形图片容器</option>
								<option value="circular">圆形图片容器</option>
								<option value="textarea">文本容器</option>
								<option value="justshow">展示文字容器</option>
								<option value="score">单选容器</option>
								<option value="chart">图表容器</option>
								<option value="video">视频容器</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label"> <span style="color:red">*</span> 容器尺寸</label>
						<div class="col-sm-3 CheckReset">
                            <div class="input-group">
                                <span class="input-group-addon">宽</span>
								<input type="number" class="form-control cleanTarget" id="NewContainerWidth"  value="" />
                                <span class="input-group-addon">px</span>
                            </div>
                            <div class="help-block defaultInfo" >最小宽度为10px</div>
                            <div class="help-block failInfo" style="color:red;">请填写大于等于10的整数</div>
						</div>
						<div class="col-sm-3 CheckReset">
							<div class="input-group">
                                <span class="input-group-addon">高</span>
								<input type="number" class="form-control cleanTarget" id="NewContainerHeight"  value="" />
                                <span class="input-group-addon">px</span>
                            </div>
                            <div class="help-block defaultInfo" >最小高度为10px</div>
                            <div class="help-block failInfo" style="color:red;">请填写大于等于10的整数</div>
						</div>
					</div>
                    <div class="form-group txtConSet showConSet toggleConSet showScoreSet videoSet">
						<label class="col-sm-2 control-label">字体大小</label>
						<div class="col-sm-3">
                            <div class="input-group">
								<input type="number" class="form-control cleanTarget" id="NewContainerFontSize" placeholder="12" value="12" min="1"/>
                                <span class="input-group-addon">px</span>
                            </div>
                            <div class="help-block">默认为12px</div>
                        </div>
						<label class="col-sm-2 control-label">字体行高</label>
						<div class="col-sm-3">
							<div class="input-group">
								<input type="number" class="form-control cleanTarget" id="NewContainerLineHeight" placeholder="12" value="12" min="1"/>
                                <span class="input-group-addon">px</span>
                            </div>
                            <div class="help-block">默认为12px</div>
						</div>
                    </div>
                    <div class="form-group txtConSet showConSet toggleConSet showScoreSet videoSet showChartSet">
                        <label class="col-xs-12 col-sm-3 col-md-2 control-label bgcolortxt" >文字颜色</label>
                        <div class="col-sm-8">
                            <script type="text/javascript">
                                $(function(){
                                    $("#AddFontColor .colorpicker").each(function(){
                                        var elm = this;
                                        util.colorpicker(elm, function(color){
                                            $(elm).parent().prev().prev().val(color.toHexString());
                                            $(elm).parent().prev().css("background-color", color.toHexString());
                                        });
                                    });
                                    $("#AddFontColor .colorclean").click(function(){
                                        $(this).parent().prev().prev().val("");
                                        $(this).parent().prev().css("background-color", "#FFF");
                                    });
                                });
                            </script>
                            <div class="row row-fix" id="AddFontColor">
                                <div class="col-xs-8 col-sm-8" style="width: 300px;">
                                    <div class="input-group">
                                        <input class="form-control cleanTarget" type="text" id="NewContainerFontColor"  name="headcolor" placeholder="#323232" value="#323232">
                                        <span class="input-group-addon" style="width:35px;border-left:none;background-color:#323232"></span>
                                        <span class="input-group-btn">
                                            <button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>
                                            <button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>
                                        </span>
                                    </div>
                                    <div class="help-block">默认为#323232</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group txtConSet videoSet toggleConSet">
						<label class="col-sm-2 control-label"> <span style="color:red">*</span> 最大字数</label>
						<div class="col-sm-3 CheckReset">
                            <div class="input-group">
								<input type="number" class="form-control cleanTarget" id="NewContainerMaxLength"/>
                            </div>
                            <div class="help-block failInfo" style="color:red" >请填写最大字数</div>
                        </div>
                    </div>
                    <div class="form-group txtConSet toggleConSet">
						<label class="col-sm-2 control-label">文字提示</label>
						<div class="col-sm-8">
                            <input type="text" class="form-control cleanTarget" id="NewContainerPlaceholder"/>
                        </div>
                    </div>
                    <div class="form-group txtConSet toggleConSet">
                        <label class="col-sm-2 control-label">选择分类</label>
                        <div class="col-sm-10" style="margin-top: 6px;">
                            {loop $comment $row}
                            <label class="checkbox-inline" ></label><input type="checkbox" name="typeid" value="{$row['sid']}">{$row['sname']}</label>
                            {/loop}
                        </div>
						<!-- <div class="col-sm-4">
                            <select style="margin-right:15px;" id="typeid" class="form-control cleanTarget">
                                <option value="0">请选择分类</option>
                                {loop $comment $row}
                                <option value="{$row['sid']}">{$row['sname']}</option>
                                {/loop}
							</select>
                        </div> -->
                    </div>
                    <div class="form-group showConSet toggleConSet">
						<label class="col-sm-2 control-label">展示内容</label>
						<div class="col-sm-4">
                            <select style="margin-right:15px;" id="showInfo" class="form-control cleanTarget">
								<option value="schoolTitle">学校名称</option>
								<option value="stuClass">学生班级</option>
								<option value="stuName">学生姓名</option>
								<option value="schoolQrcode">学校二维码</option>
								<option value="schoolLogo">学校logo</option>
							</select>
						</div>
                    </div>
                    <div class="form-group showScoreSet toggleConSet">
                        <div class="form-group">
                            <label class="col-sm-2 control-label"> <span style="color:red">*</span> 标题</label>
                            <div class="col-sm-4 CheckReset">
                                <div class="input-group">
                                    <input type="text" id="title" class="form-control cleanTarget"/>
                                </div>
                                <div class="help-block failInfo" style="color:red" >请填写标题</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">选项个数</label>
                            <div class="col-sm-4">
                                <select style="margin-right:15px;" id="ScoreNum" class="form-control cleanTarget" >
                                    <option value='2'>2</option>
                                    <option value='3'>3</option>
                                    <option value='5'>5</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group ColumnData">
                            <label class="col-sm-2 control-label">选项内容</label>
                            <div id="ColumnValue">
                                <div class="col-sm-2" style="width: 90px;">
                                    <input type="text" class="form-control cleanTarget"/>
                                </div>
                                <div class="col-sm-2" style="width: 90px;">
                                    <input type="text" class="form-control cleanTarget"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group showChartSet toggleConSet">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">类型</label>
                            <div class="col-sm-4">
                                <select style="margin-right:15px;" id="ChartType" class="form-control cleanTarget">
                                    <option value="1">考勤</option>
                                    <option value="2">晨检</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间范围</label>
                            <div class="col-sm-8">
                                {php echo tpl_form_field_daterange('createtime', array('start' => date('Y-m-d', TIMESTAMP - 86399*7), 'end' => date('Y-m-d', TIMESTAMP + 86399*7)));}
                            </div>
                        </div>

                        <div class="form-group" style="display: none;" id="chartBox">
                            <label class="col-sm-2 control-label">展示内容</label>
                            <div class="col-sm-8">
                                <input type="checkbox" name="chartMenu[]" value="height">身高
                                <input type="checkbox" name="chartMenu[]" value="weight">体重
                                <input type="checkbox" name="chartMenu[]" value="tiwen">体温
                                <input type="checkbox" name="chartMenu[]" value="lefteye">左眼
                                <input type="checkbox" name="chartMenu[]" value="righteye">右眼
                            </div>
                        </div>
                    </div>
                    <div class="form-group videoSet toggleConSet">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">文字描述</label>
                            <div class="col-sm-8">
                                <input id="description" class="form-control"  style="resize: none;border: 1px solid #ecebeb; padding: 5px;" />
                            </div>
                        </div>
                    </div>
				</form>
			</div>
			<div class="modal-footer" style="border-radius: 6px;">
				<input type="submit" onclick="SureAddContainer()" class="btn btn-primary" value="添加">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			</div>
			<input id="tk_now_ksid" type="hidden" value=""/>
		</div>
	</div>
</div>

<div class="modal fade" style="min-width: 600px!important;" id="Modal11" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"  >
	<div class="modal-dialog" style="left: 50%; top:50%;transform: translate(-50%,-50%);width: auto;">
		<div class="modal-content" style="background-color: transparent;display: flex;">
            <div class="modal-body form_paike_boxs" style="padding: 7px;position: relative;flex: 1;" >
                <div style="position: absolute;width: 100%;height: 100%;top:0;left: 0;z-index: 2;" > </div>
                <div id='ShowHtmlContent'> </div>
            </div>
            <div style="width: 300px;">
                <div class="modal-footer" style="border-radius: 6px; margin-top: 0px;background-color: transparent;">
                    <input type="submit" style="background-color: rgba(65,202,192,0.46);" onclick="AddSure()" class="btn btn-primary" value="保存">
                    <button type="button" style="background-color: transparent;color:white" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
                <div class="modal-footer"  style="border-radius: 6px; margin-top: 0px;background-color: transparent;color:white;font-size: 14px;">
                    此处预览效果即为当前模板页最终效果
                </div>
            </div>

		</div>
	</div>
</div>
<script>

    function RemoveContainer(){ //移除容器
        let ActiveIndex = -1 ;
        PageContainerList.map((v,index) => {
            if(v === ActiveContainerData){
                ActiveIndex = index
            }
        })
        if(ActiveIndex >= 0){
            PageContainerList.splice(ActiveIndex, 1)
            TempActCon = ActiveContainer
            CancelActiveContainer()
            $(TempActCon).remove()

        }
    }

    

    function ShowHtml(){//预览
        CancelActiveContainer()
        let ShowHtml = $('#tpl_page').prop("outerHTML");
        $("#ShowHtmlContent").html(ShowHtml)
        $("#ShowHtmlContent .max_num.txtcontent").hide()

        $("#ShowHtmlContent .img_container_list").css("z-index",'14')
        $("#ShowHtmlContent .container_box").css("background-color",'transparent ')
        $("#ShowHtmlContent .container_box").css("box-shadow",'none')
        $("#ShowHtmlContent .img_container_list .container_box").css("background-color",'white')
        $("#Modal11 .pageBackMask").css({"z-index":"13"})
        $('#Modal11').modal('toggle',150)
    }

    $('#ScoreNum').change(function(){ //单选容器选项个数更改事件监听
        ScoreNum = $(this).children('option:selected').val();
        var ScoreHtml = ''
        for (let index = 1; index <= ScoreNum; index++) {
            ScoreHtml += `<div class="col-sm-2" style="width: 90px;">
                                <input type="text" class="form-control"/>
                            </div> `
        }
        $("#ColumnValue").html(ScoreHtml)
    })

</script>


<script type="text/javascript">
    var ActiveContainer, //当前操作的container节点
        ActiveContainerData ,
        PageBackGroundImgUrl = '',
        PageContainerList = [],
        StopListenKey = false,
        //拖拽定位option
        dragOption = {
            containment: "#tpl_page",
            drag: function (event, ui) {
                setContainerData('Position',ui.position.top,'top')
                setContainerData('Position',ui.position.left,'left')
            },
            start: function (event, ui) {
                SetActiveContainer($(event.target),".container_box")
            }
        },
        //重定尺寸option
        resizeOption = {
            containment: "#tpl_page",
            resize: function (event, ui) {
                setContainerData('Client',ui.size.width,'width')
                setContainerData('Client',ui.size.height,'height')
            }
        }
        //测试数据
        PageContainerList = [];

        

    function _init() {
        let FirstData = {
            id : `{$_GPC['id']}`,
            schoolid : `{$_GPC['schoolid']}`,
        }
        if(`{$_GPC['id']}`){
            $.post("{php echo $this->createWebUrl('manualmubanpage',array('op'=>'GetFirstPage'))}", FirstData, function(data) {
                let ContainerBoxData = data.data.container;
                PageContainerList = ContainerBoxData || [];
                $("input[name=pageBackImg]").val(`${data.data.bgimg}`);
                $("#pageBackMask").css("background",`url(${data.data.backgroundimg}) center center / 100% 100% no-repeat`)
                if(PageContainerList){
                    PageContainerList.map((x) =>{
                        let aa = 'render_'+x.itemType
                        eval(aa + '(x)')
                    })
                }
                AddClickAndDragFunction(".container_box")
            },'json');
        }
    }
    _init()
    function setContainerData(DataType,DataValue, DataTarget, isReload) {  //修改容器对应参数处理器
        let NoNum = false;
        if(DataTarget == 'fontColor'){
            ActiveContainerData[DataType][DataTarget] = DataValue
            $('#ActItem-backGround').css('background-color', `${DataValue}`)
        }
        if(ActiveContainerData.itemType == 'justshow'){
            if(DataTarget == 'fontColor'){
                $(ActiveContainer.find('.titlesize')).css('color',`${DataValue}`)
                NoNum = true
            }
            if(DataTarget == 'fontSize'){
                $(ActiveContainer.find('.titlesize')).css('font-size',`${DataValue}px`)
            }
        }
        if(ActiveContainerData.itemType == 'score'){
            if(DataTarget == 'fontColor'){
                $(ActiveContainer.find('.scorecom')).css('color',`${DataValue}`)
                NoNum = true
            }
            if(DataTarget == 'fontSize'){
                let imgsize = Number(`${DataValue}`)+3;
                $(ActiveContainer.find('.scorecom')).css('font-size',`${DataValue}px`)
                $(ActiveContainer.find('img')).css('width',`${imgsize}px`)
                $(ActiveContainer.find('img')).css('height',`${imgsize}px`)
            }
            if(DataTarget == 'lineHeight'){
                $(ActiveContainer.find('.scorecom')).css('line-height',`${DataValue}px`)
            }
        }

        if(ActiveContainerData.itemType == 'video'){
            if(DataTarget == 'fontColor'){
                $(ActiveContainer.find('.videocom')).css('color',`${DataValue}`)
                NoNum = true
            }
            if(DataTarget == 'fontSize'){
                $(ActiveContainer.find('.videocom')).css('font-size',`${DataValue}px`)
            }
            if(DataTarget == 'lineHeight'){
                $(ActiveContainer.find('.videocom')).css('line-height',`${DataValue}px`)
            }
            if(DataTarget == 'description'){
                $(ActiveContainer.find('.videocom')).html(`${DataValue}`)
                NoNum = true
            }
        }
        if(ActiveContainerData.itemType == 'textarea'){
            if(DataTarget == 'fontColor'){
                $(ActiveContainer).css('color',`${DataValue}`)
                NoNum = true
            }
            if(DataTarget == 'fontSize'){
                $(ActiveContainer.find('.txtcontent')).css('font-size',`${DataValue}px`)
            }
            if(DataTarget == 'lineHeight'){
                $(ActiveContainer.find('.txtcontent')).css('line-height',`${DataValue}px`)
            }
            if(DataTarget == 'maxLength'){
                $(ActiveContainer.find('.txtcontent')).html(`0/${DataValue}`)
            }
            if(DataTarget == 'placeholder'){
                $(ActiveContainer.find('.placeholdertxt')).html(`${DataValue}`)
                NoNum = true
            }
        }
        
        if(ActiveContainerData.itemType == 'chart'){
            if(DataTarget == 'ChartBgColor'){
                NoNum = true
                $(".chart_container_list").find('.editActive').css('background-color', `${DataValue}`)
                $('#ActItem-BgColor').css('background-color', `${DataValue}`)
            }
            if(DataTarget == 'chartMenu'){
                NoNum = true
            }
        }
        if(NoNum === true){
            if(DataTarget == 'chartMenu'){
                ActiveContainerData[DataType][DataTarget] = [];
                $("#CheckChartMenu").find("input[type='checkbox']:checked").each(function(){
                    ActiveContainerData[DataType][DataTarget].push($(this).val())
                })
            }else{
                ActiveContainerData[DataType][DataTarget] = DataValue
            }
        }else{
            ActiveContainerData[DataType][DataTarget] = Number(DataValue)
        }
        $(`#ActItem-${DataTarget}`).val(DataValue)
        if (isReload === true) {
            $(ActiveContainer).css(DataTarget, `${DataValue}px`)
        }
    }

    function SetActiveContainer(e,cancelClass){//设置当前操作容器
        if( ActiveContainer === undefined || ActiveContainer[0] != $(e)[0] ){
            CancelActiveContainer()
            ActiveContainer = $(e)
            $("#container").on('click',function(){
                CancelActiveContainer()
            })
            PageContainerList.map(function(s){
                if(s.itemType == $(e).attr("type") && s.Position.zIndex == $(e).css('z-index')){
                    ActiveContainerData = s
                }
            })
            setContainerData('Position',$(e).position().top,'top')
            setContainerData('Position',$(e).position().left,'left')
            setContainerData('Client',$(e).width(),'width')
            setContainerData('Client',$(e).height(),'height')
            if(ActiveContainerData.itemType != 'score'){
                $('.scoreimgdata').hide()
                $('#ScoreItemData').hide()
            }else{
                $('#ScoreItemData').show()
            }
            if(ActiveContainerData.itemType === 'video'){
                $('#videodescription').show()
            }else{
                $('#videodescription').hide()
            }
            let LineListTitle = ActiveContainerData.Client.title
            let LineListScoreData = ActiveContainerData.Client.scoreData
            let ScoreHtml = '';
            if(LineListScoreData){
                    ScoreHtml += `<div class="form-group LineListTitle">
                                        <label class="col-sm-2 control-label">选项名</label>
                                        <div class="col-sm-6">
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="ActItem-title" data-type="Client" data-target="height"  value="${LineListTitle}" />
                                            </div>
                                        </div>
                                    </div>`
                    ScoreHtml += `<div class="form-group ">
                        <label class="col-sm-2 control-label">选项内容</label>
                        <div class="col-sm-10">
                            <div class="input-group LineListScoreData">`
                                for(i in LineListScoreData){
                                    ScoreHtml += `<div class="col-sm-2" style="width: 90px;">
                                                    <input type="text" value="${LineListScoreData[i]}" class="form-control"/>
                                                </div>`
                                    $("#ScoreImg"+`${i}`).show()
                                }
                            `</div>
                        </div>
                    </div>`
                $("#ScoreItemData").html(ScoreHtml)
                SetScoreData(ActiveContainerData.Position.zIndex)
            }
            $(cancelClass).removeClass('editActive')
            $(e).addClass("editActive")
            $("#EditBox").show()
            if(ActiveContainerData.itemType == 'textarea' || ActiveContainerData.itemType == 'justshow' || ActiveContainerData.itemType == 'score' || ActiveContainerData.itemType == 'video'){
                setContainerData('Client',ActiveContainerData.Client.fontSize,'fontSize')
                setContainerData('Client',ActiveContainerData.Client.lineHeight,'lineHeight')
                // if(ActiveContainerData.itemType != 'video'){
                    setContainerData('Client',ActiveContainerData.Client.maxLength,'maxLength')
                // }
                setContainerData('Client',ActiveContainerData.Client.fontColor,'fontColor')
                
                $("#ShowTxtContainer").show()
                if(ActiveContainerData.Client.showInfo == 'schoolQrcode' || ActiveContainerData.Client.showInfo == 'schoolLogo'){
                    $("#ShowTxtContainer").hide()
                }
                if(ActiveContainerData.itemType == 'justshow' || ActiveContainerData.itemType == 'score'){
                    $("#MaxSize").hide()
                }else{
                    $("#MaxSize").show()
                }
                if(ActiveContainerData.itemType == 'textarea'){
                    setContainerData('Client',ActiveContainerData.Client.placeholder,'placeholder')
                    $("#placeholder").show()
                }else{
                    $("#placeholder").hide()
                }
                if(ActiveContainerData.itemType == 'video'){
                    setContainerData('Client',ActiveContainerData.Client.description,'description')
                }
            }else{
                $("#ShowTxtContainer").hide()
            }
            //图表相关设置
            if(ActiveContainerData.itemType === 'chart'){
                $('#chart').show()
                $(`#CheckChartMenu input[type=checkbox]`).prop('checked',false)
                ActiveContainerData.Client.chartMenu.forEach(element => {
                    $(`#CheckChartMenu input[value=${element}]`).prop('checked',true)
                });
                $("#CheckChartBox").hide()
                if(ActiveContainerData.Client.ChartType == 2){
                    $("#CheckChartBox").show()
                }
                $("#CheckChartType").val(ActiveContainerData.Client.ChartType)
                $("input[name='CheckCreatetime[start]']").val(ActiveContainerData.Client.start)
                $("input[name='CheckCreatetime[end]']").val(ActiveContainerData.Client.end)
                $($("input[name='CheckCreatetime[end]']").next().find('.date-title')).html(ActiveContainerData.Client.start+'至'+ActiveContainerData.Client.end)
                setContainerData('Client',ActiveContainerData.Client.ChartBgColor,'ChartBgColor')
            }else{
                $('#chart').hide()
            }

            ActiveContainer.resizable(resizeOption)
        }
    }


    /**********************设置当前操作容器(关于score容器)*****************/
    function SetScoreData(zIndex){
        $("#ScoreItemData .LineListTitle input").off('input propertychange')

        $("#ScoreItemData .LineListTitle input").on('input propertychange', function(){
            let title = $(this).val();
            $($(".container_score").find('.scoreItem')[zIndex]).find('.scoreItemTxt').text(title)
            setContainerScoreData('Client',0,title,'title');
        })

        $("#ScoreItemData").find('.LineListScoreData').each(function(){
            $(this).find('input').off('input propertychange')
        })

        $("#ScoreItemData ").find('.LineListScoreData').each(function(){
            $(this).find('input').on('input propertychange',function(){
                let scorename = $(this).val()
                let type = 'score';
                let itemindex = $(this).parent().index();
                $($($($(".container_score").find('.scoreItem')[zIndex]).find('.scoreContent')[itemindex])).find('span').html(scorename)
                $($($($(".container_score").find('.scoreItem')[zIndex]).find('.scoreContent')[itemindex])).find('input').val(scorename)
                setContainerScoreData('Client',itemindex,scorename,'scoreData');
            })
        })
    }
    function setContainerScoreData(type,itemindex,DataValue,ScoreType){
        if(ScoreType == 'title'){
            ActiveContainerData[type][ScoreType] = DataValue
        }else{
            ActiveContainerData[type][ScoreType][itemindex] = DataValue
        }
    }
    /**********************设置当前操作容器(关于score容器)*****************/

    function CancelActiveContainer(){//取消当前操作容器
       
        if(ActiveContainer !== undefined){
            $(ActiveContainer).resizable("destroy")
            if(ActiveContainerData.itemType == 'chart'){
                ActiveContainerData.Client.start = $("input[name='CheckCreatetime[start]']").val()
                ActiveContainerData.Client.end = $("input[name='CheckCreatetime[end]']").val()
            }
        }
        ActiveContainer = undefined;
        $(".container_box").removeClass('editActive')
        $("#EditBox").hide();
        $("body").off('click')
    }

    function AddClickAndDragFunction(OpClass){//对所有容器添加监听事件，每次添加了容器都要重新执行此函数，避免新容器无法触发监听事件
        $(OpClass).off('click')
        $(OpClass).on('click',function(event) {
            event.stopPropagation();
            SetActiveContainer(this,OpClass)
            $("input").blur();
        })
        $(OpClass).draggable(dragOption)
    }

    function CleanModal(){ //重置添加容器弹出框
        $("#Modal10").find(".cleanTarget").val('')
        $(".toggleConSet").hide()
        $("#Modal10").find(".NeedHideDefault").hide()
        $("#Modal10").find("select").each(function(){
            $(this).val($(this).find("option:first-child").val())
        })
        $(`#Modal10 input[name='chartMenu[]']`).prop('checked',false)

        $("#Modal10 .Fail").removeClass("Fail")
    }

    function render_square(containderData){ //渲染方形容器
        let html = `<div type="square" class="container_box img_box is_select" style="position:absolute;z-index:${containderData.Position.zIndex}; top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0);-webkit-transform:rotate(0);background: url(https://manger.weimeizhan.com/addons/fm_jiaoyu/public/web/images/select_logo.png) no-repeat center;"></div>`;
        $(".img_container_list").append(html)
    }

    function render_circular(containderData){ //渲染圆形容器
        let html = `<div type="circular" class="container_box img_box is_select" style="position:absolute;z-index:${containderData.Position.zIndex}; top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0);-webkit-transform:rotate(0);background: url(https://manger.weimeizhan.com/addons/fm_jiaoyu/public/web/images/select_logo.png) no-repeat center;border-radius:50%"></div>`;
        $(".img_container_list").append(html)
    }

    function render_textarea(containderData){ //渲染文本容器
        let html = `<div type="textarea" class="container_box" style="position:absolute;z-index:${containderData.Position.zIndex}; top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0);-webkit-transform:rotate(0);font-size:${containderData.Client.fontSize}px;line-height:${containderData.Client.lineHeight}px;color:${containderData.Client.fontColor};">
                <span style=" color:${containderData.Client.fontColor}; padding: 7px; display: block;" class="placeholdertxt">${containderData.Client.placeholder}</span>
                <div class="max_num txtcontent" max_num="${containderData.Client.maxLength}" style="display: inline-block;font-family:zk;position: absolute;right: 5px;bottom: 5px;font-size: ${containderData.Client.fontSize}px;line-height: ${containderData.Client.lineHeight}px; height: 20px;">0/${containderData.Client.maxLength}</div>
            </div>`;
        $(".txt_container_list").append(html)
    }

    function render_justshow(containderData){ //渲染justshow容器
        if(containderData.Client.showInfo == 'schoolQrcode' || containderData.Client.showInfo == 'schoolLogo'){
            let html = `<div type="justshow" data-type="${containderData.Client.showInfo}" class="container_box" style="position:absolute;z-index:${containderData.Position.zIndex};top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0deg);-webkit-transform:rotate(0deg);text-align: center;font-size:${containderData.Client.fontSize}px;line-height:${containderData.Client.lineHeight}px">
                <div style="position: absolute;z-index: 2;width:100%;height:100%;font-family:zk;font-size:${containderData.Client.fontSize}px;color:${containderData.Client.fontColor};background-color: transparent;resize: none;display: block;transform-origin:left top 0;-webkit-transform-origin:left top 0;transform:scale(1);-webkit-transform:scale(1);text-align:center;" class="titlesize"><img src='{MODULE_URL}/public/web/images/qrcode_example.png' style="width: 100%;padding: 5px;object-fit:contain;height:100%"></div>
            </div>`;
            $(".show_container_list").append(html)
        }else{
            let html = `<div type="justshow" data-type="${containderData.Client.showInfo}" class="container_box" style="position:absolute;z-index:${containderData.Position.zIndex};top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0deg);-webkit-transform:rotate(0deg);text-align: center;font-size:${containderData.Client.fontSize}px;line-height:${containderData.Client.lineHeight}px">
                <div style="position: absolute;z-index: 2;width:100%;height:100%;font-family:zk;font-size:${containderData.Client.fontSize}px;color:${containderData.Client.fontColor};background-color: transparent;resize: none;display: block;transform-origin:left top 0;-webkit-transform-origin:left top 0;transform:scale(1);-webkit-transform:scale(1);text-align:center;" class="titlesize">${containderData.Client.showInfo}</div>
            </div>`;
            $(".show_container_list").append(html)
        }
        
    }

    function render_chart(containderData){ //渲染chart容器
        let html = `<div data-chart_type="${containderData.Client.ChartType}" data-time_start="${containderData.Client.start}" data-time_end="${containderData.Client.end}"  type="chart" class="container_box img_box" style="position:absolute;z-index:${containderData.Position.zIndex}; top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0);-webkit-transform:rotate(0);background: url({MODULE_URL}/public/web/images/tabletemplate.png) no-repeat center;background-size:90%;background-color:${containderData.Client.ChartBgColor}"></div>`;
        $(".chart_container_list").append(html)
    }

    function render_score(containderData){ //渲染score容器
        let ScoreDataWidth = containderData.Client.scoreData == undefined ? 3 : (100 / containderData.Client.scoreData.length)+'%';
        let html = `<div type="score" class="container_box container_score" style="position:absolute;z-index:${containderData.Position.zIndex};top:${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0deg);-webkit-transform:rotate(0deg);"><li class="scoreItem" style="display:flex;width:100%;height:100%;align-items: center;">
                <div class="scoreItemTxt scorecom" style="flex:1;width:15vw;position:relative;float:left;margin-right:5px;color:${containderData.Client.fontColor};font-size:${containderData.Client.fontSize}px;line-height: ${containderData.Client.lineHeight}px;overflow:hidden">
                    <span  > ${containderData.Client.title} </span>
                </div>`;
        for(let i in containderData.Client.scoreData){
            let imgWidthHeight = Number(`${containderData.Client.fontSize}`) + 3;
            html += `<div class="scoreContent" style="flex:1;display: flex; width:${ScoreDataWidth};line-height: ${containderData.Client.lineHeight}px;">
                <img data-src-img="${i}" src="${containderData.Client.scoreImgData[i]}" style="width:${imgWidthHeight}px; height:${imgWidthHeight}px; margin: -1px 5px 0 0;">
                <div style="height: 13px;width: 13px;border-radius: 50%;border:1px solid gray;background-color:white"></div>
                <span class="scorecom" style="color:${containderData.Client.fontColor};line-height: ${containderData.Client.lineHeight}px;font-size:${containderData.Client.fontSize}px;">${containderData.Client.scoreData[i]}</span>
                </div>`
                $(`input[name='ScoreImg${i}']`).val(`${containderData.Client.scoreImgData[i]}`.substring(30))

        }
        html +=`</li></div>`;
        $(".score_container_list").append(html)
    }

    function render_video(containderData){ //渲染视频容器
        let html = `<div type="video" class="container_box img_box is_select" style="position:absolute;z-index:${containderData.Position.zIndex}; top: ${containderData.Position.top}px;left: ${containderData.Position.left}px;width: ${containderData.Client.width}px;height: ${containderData.Client.height}px;transform:rotate(0);-webkit-transform:rotate(0);">
             <div style="display:flex;flex-direction:column;height:100%">
                <img src="https://manger.weimeizhan.com/addons/fm_jiaoyu/public/web/images/qrcode_example.png" style="width: 100%;object-fit: contain; height: 1px; flex: 1;margin-bottom:4px"/>
                <div class="videocom"  style="border-top: 1px solid #c1c1c1;width: 100%; top: 170px; padding: 3px; font-size:${containderData.Client.fontSize}px; color:${containderData.Client.fontColor}; line-height:${containderData.Client.lineHeight}px;white-space: normal; word-break: break-all; word-wrap: break-word;">${containderData.Client.description}</div>
            </div>
            </div>`;
        $(".video_container_list").append(html)
    }

    function SureAddContainer(){ //添加容器
        let Type = $("#containerType").val();
        let NewCon = {};
        let containerHeight = Number($("#NewContainerHeight").val())
        let containerWidth = Number($("#NewContainerWidth").val())
        let IsRT = false;
        if(containerHeight < 10){
            $("#NewContainerHeight").parent().parent().addClass("Fail")
            IsRT = true
        }
        if(containerWidth < 10){
            $("#NewContainerWidth").parent().parent().addClass("Fail")
            IsRT = true
        }
        if(IsRT === true){
            return
        }
        if(Type === 'square'){
            let nowMaxIndex =  1 ;
            if($(".img_container_list").children(".img_box:last-child").length > 0){
                nowMaxIndex = Number($(".img_container_list").children(".img_box:last-child").css("z-index")) + 1
            }
            NewCon = {
                itemType:'square',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    ExInfo03 :1,
                    PhotoUrl : '',
                    OffsetValue : ''
                },
            };
            render_square(NewCon)
        }
        if(Type === 'circular'){
            let nowMaxIndex =  1 ;
            if($(".img_container_list").children(".img_box:last-child").length > 0){
                nowMaxIndex = Number($(".img_container_list").children(".img_box:last-child").css("z-index")) + 1
            }
            NewCon = {
                itemType:'circular',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    ExInfo03 :1,
                    PhotoUrl : '',
                    OffsetValue : ''
                },
            };
            render_circular(NewCon)
        }
        if(Type === 'textarea'){
            let nowMaxIndex =  1 ;
            if($(".txt_container_list").children(".container_box:last-child").length > 0){
                nowMaxIndex = Number($(".txt_container_list").children(".container_box:last-child").css("z-index")) + 1
            }
            let FontSize = Number($("#NewContainerFontSize").val())  || 12
            let LineHeight = Number($("#NewContainerLineHeight").val())  || 12
            let FontColor = $("#NewContainerFontColor").val() || '#323232'
            let maxLength = Number($("#NewContainerMaxLength").val())
            if (maxLength < 1){
                $("#NewContainerMaxLength").parent().parent().addClass("Fail")
                return
            }
            let Placeholder = String($("#NewContainerPlaceholder").val())
            let typeidarr = []
            $("input[name='typeid']:checked").each(function(){
                typeidarr.push($(this).val())
            })
            typeid = typeidarr.join(',')
            NewCon = {
                itemType:'textarea',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    fontSize:FontSize,
                    lineHeight:LineHeight,
                    maxLength: maxLength,
                    typeid: typeid,
                    fontColor:FontColor,
                    placeholder:Placeholder
                },
            };
            render_textarea(NewCon)
        }
        if(Type === 'justshow'){
            let nowMaxIndex =  1 ;
            if($(".show_container_list").children(".container_box:last-child").length > 0){
                nowMaxIndex = Number($(".show_container_list").children(".container_box:last-child").css("z-index")) + 1
            }
            let FontSize = Number($("#NewContainerFontSize").val())  || 12
            let LineHeight = Number($("#NewContainerLineHeight").val())  || 12
            let FontColor = $("#NewContainerFontColor").val() || '#323232'


            let showInfo = $("#showInfo").val()
            let showTitle = $("#showInfo").find('option:selected').text();
            NewCon = {
                itemType:'justshow',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    fontSize:FontSize,
                    lineHeight:LineHeight,

                    fontColor:FontColor,
                    showInfo:showInfo,
                    showTitle:showTitle
                },
            };
            render_justshow(NewCon)
        }
        if(Type === 'chart'){
            let nowMaxIndex =  1 ;
            if($(".chart_container_list").children(".container_box:last-child").length > 0){
                nowMaxIndex = Number($(".chart_container_list").children(".container_box:last-child").css("z-index")) + 1
            }
            let start = $("input[name='createtime[start]']").val()
		    let end = $("input[name='createtime[end]']").val()
            let chartMenu = [];
            $("input[name='chartMenu[]']:checked").each(function(i){
                chartMenu.push($(this).val());
            })
            let ChartType = $("#ChartType").val()
            let ChartBgColor = $("#NewContainerFontColor").val() || '#ffffff'
            NewCon = {
                itemType:'chart',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    start:start,
                    end: end,
                    ChartType:ChartType,
                    ChartBgColor:ChartBgColor,
                    chartMenu:chartMenu,
                },
            };
            render_chart(NewCon)
            // $(".chart_container_list").find('.is_select').removeClass('is_select');
            // $(".chart_container_list").children("div:last-child").addClass('is_select');
            // var img_box_elm = $('.chart_container_list .is_select'); //被选中的容器
            // render_chart_box(img_box_elm)
        }
        if(Type === 'score'){
            let nowMaxIndex =  1 ;
            if($(".score_container_list").children(".container_box:last-child").length > 0){
                nowMaxIndex = Number($(".score_container_list").children(".container_box:last-child").css("z-index")) + 1
            }
            let MaxColumn = $("#ScoreColumn").val();
            let ScoreData = []
            let ScoreImgData = []
            let title = $("#title").val()
            if(title === ''){
                $("#title").parent().parent().addClass("Fail")
                return
            }
            $(".ColumnData").each(function(i){
                $(this).find('input').each(function(j){
                    ScoreData.push($(this).val());
                    ScoreImgData.push(`{OSSURL}public/mobile/img/flower${j}.png`);
                });
            })
            let ScoreDataWidth = (100 / ScoreData.length)+'%';
            let FontSize = Number($("#NewContainerFontSize").val())  || 12
            let LineHeight = Number($("#NewContainerLineHeight").val())  || 12
            let FontColor = $("#NewContainerFontColor").val() || '#323232'
            let showIcon = Number($("#showIcon").val())
            NewCon = {
                itemType:'score',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    fontSize:FontSize,
                    title:title,
                    lineHeight:LineHeight,
                    fontColor:FontColor,
                    scoreData:ScoreData,
                    scoreImgData:ScoreImgData,
                    showIcon:showIcon,
                },
            };
            render_score(NewCon)
        }
        if(Type === 'video'){
            let nowMaxIndex =  1 ;
            if($(".video_container_list").children(".container_box:last-child").length > 0){
                nowMaxIndex = Number($(".video_container_list").children(".container_box:last-child").css("z-index")) + 1
            }
            let description = $("#description").val()
            let FontSize = Number($("#NewContainerFontSize").val())  || 12
            let LineHeight = Number($("#NewContainerLineHeight").val())  || 12
            let FontColor = $("#NewContainerFontColor").val() || '#323232'
            let maxLength = Number($("#NewContainerMaxLength").val())
            NewCon = {
                itemType:'video',
                Position: {
                    top:16,
                    left:16,
                    zIndex:nowMaxIndex,
                },
                Client: {
                    width:containerWidth,
                    height:containerHeight,
                    fontSize:FontSize,
                    lineHeight:LineHeight,
                    fontColor:FontColor,
                    description:description,
                    maxLength: maxLength,
                    videoQrUrl: '',
                },
            };
            render_video(NewCon)
        }
        $('#Modal10').modal('hide')
        PageContainerList.push(NewCon)
        AddClickAndDragFunction(".container_box")
    }

    function CopyContainer(){ //复制容器
        $("#containerType").val(ActiveContainerData.itemType)
        if(ActiveContainerData.itemType == 'textarea'){
            $('.txtConSet').slideDown(150)
            var typeidArr = ActiveContainerData.Client.typeid.split(',');
            $("input[name='typeid']").each(function(){
                if(typeidArr.indexOf($(this).val()) > -1){
                    $(this).prop('checked',true)
                }
            })
        }
        if(ActiveContainerData.itemType == 'chart'){
            $("#ChartType").val(ActiveContainerData.Client.ChartType)
            $("input[name='chartMenu[]']").each(function(){
                if(ActiveContainerData.Client.chartMenu.indexOf($(this).val()) > -1){
                    $(this).prop('checked',true)
                }
            })
        }

        if(ActiveContainerData.itemType == 'score'){
            $("#title").val(ActiveContainerData.Client.title)
            let scoreLength = ActiveContainerData.Client.scoreData.length
            $("#ColumnValue").html('')
            for(i = 0 ; i<scoreLength ; i ++){
                $("#ColumnValue").append(`<div class="col-sm-2" style="width: 90px;">
                                    <input type="text" class="form-control cleanTarget" value=${ActiveContainerData.Client.scoreData[i]}>${ActiveContainerData.Client.scoreData[i]}
                                </div>`)
            }
        }
        $("#NewContainerHeight").val(ActiveContainerData.Client.height)
        $("#NewContainerWidth").val(ActiveContainerData.Client.width)
        // $(".img_container_list").children(".img_box:last-child").css("z-index",ActiveContainerData.Position.zIndex)
        $("#NewContainerFontSize").val(ActiveContainerData.Client.fontSize)
        $("#NewContainerLineHeight").val(ActiveContainerData.Client.lineHeight)
        $("#NewContainerFontColor").val(ActiveContainerData.Client.fontColor)
        $("#NewContainerMaxLength").val(ActiveContainerData.Client.maxLength)
        $("#NewContainerPlaceholder").val(ActiveContainerData.Client.placeholder)
        $("#NewContainerFontSize").val(ActiveContainerData.Client.fontSize)
        $("#showInfo").val(ActiveContainerData.Client.showInfo)
        $("#showTitle").val(ActiveContainerData.Client.showTitle)
        $("input[name='createtime[start]']").val(ActiveContainerData.Client.start)
        $("input[name='createtime[end]']").val(ActiveContainerData.Client.end)
        $("#description").val(ActiveContainerData.Client.description)
        SureAddContainer()
    }

    $(function(){//所有监听事件
        $("#NewContainerHeight,#NewContainerWidth").on("input",function(){
            $(this).parent().parent().removeClass("Fail")
        })
        $("#containerType").on('change',function() {
            let conValue = $(this).val()
            $('.toggleConSet').slideUp(150)
            if(conValue === 'textarea'){
                $('.txtConSet').slideDown(150)
            }else if(conValue == 'justshow'){
                $('.showConSet').slideDown(150)
            }else if(conValue == 'score'){
                $('.showScoreSet').slideDown(150)
            }else if(conValue == 'chart'){
                $('.showChartSet').slideDown(150)
                $(".bgcolortxt").html('背景颜色')
                $("#NewContainerFontColor").val('#ffffff')
                $("#NewContainerFontColor").next().css('background-color', '#ffffff')
            }else if(conValue == 'video'){
                $('.videoSet').slideDown(150)
            }
        })

        $("#EditBox").on('click',function(event) {
            event.stopPropagation();
        })
        //当input框获取焦点时，取消上下左右联动activeContainer定位
        $("input").focus(function() {
            StopListenKey = true
        })
        //当input框失去焦点时，重新设置上下左右联动activeContainer定位
        $("input").blur(function() {
            StopListenKey = false
        })

        $("#EditBox").find('input').on('input',function(){
            let DType = $(this).data('type')
            let DTarget = $(this).data('target')
            setContainerData(DType,$(this).val(),DTarget,true)
        })

        $("#CheckChartType").change(function(){
            $("#CheckChartBox").hide()
            if($(this).val() == '2'){
                $("#CheckChartBox").show()
            }
            setContainerData('Client',$(this).val(),'ChartType',true)
        })

        $("#ChartType").change(function(){
            $("#chartBox").hide()
            if($(this).val() == '2'){
                $("#chartBox").show()
            }
        })
        //监听上下左右按键联动activeContainer定位
        document.onkeydown = function (event) {
            var e = event || window.event || arguments.callee.caller.arguments[0];
            if(ActiveContainer !== undefined && StopListenKey !== true ) {
                if (e && e.keyCode == 38) { //上键
                    let top = $(ActiveContainer).position().top - 1;
                    setContainerData('Position',top,'top',true)
                }
                if (e && e.keyCode == 37) {//左键
                    let left = $(ActiveContainer).position().left - 1;
                    setContainerData('Position',left,'left',true)
                }
                if (e && e.keyCode == 40) {//下键
                    let top = $(ActiveContainer).position().top + 1;
                    setContainerData('Position',top,'top',true)
                }

                if (e && e.keyCode == 39) { //右键
                    let left = $(ActiveContainer).position().left + 1;
                    setContainerData('Position',left,'left',true)
                }
            }else {
                return
            }
        };

        //实时改变背景图片
        $("input[name=pageBackImg]").on('change',function() {
            $("#pageBackMask").css("background",`url(${$(this).attr('url')}) center center / 100% 100% no-repeat`)
        })

        $(".scoreimgdata").each(function(){
            $(this).find('input').attr('readonly','readonly')
            $(this).find('input').on('change',function(){
                let targetindex = $(this).parent().parent().attr('data-target-index');
                let imgurl = $(`input[name=ScoreImg${targetindex}]`).attr('url')
                $($(ActiveContainer).find('.scoreContent')[targetindex]).find('img').attr('src',imgurl)
                setContainerScoreData('Client',targetindex,imgurl,'scoreImgData');
            })
        })
        require(["jquery.ui"], function(jqueryui){
            AddClickAndDragFunction(".container_box")
        });
    })
</script>
<script>
    $("#pagetype").change(function(){
        if($(this).val() == 1){
            if(`{$hasfm['id']}`){
                if(`{$_GPC['id']}` != `{$hasfm['id']}`){
                    alert('当前模板已经存在封面');
                    if(`{$mubanpage['pagetype']}`){
                        $(this).val(`{$mubanpage['pagetype']}`)
                    }else{
                        $(this).val(0)
                    }
                }
            }
        }
        if($(this).val() == 2){
            if(`{$hasbm['id']}`){
                if(`{$_GPC['id']}` != `{$hasbm['id']}`){
                    alert('当前模板已经存在末尾页');
                    if(`{$mubanpage['pagetype']}`){
                        $(this).val(`{$mubanpage['pagetype']}`)
                    }else{
                        $(this).val(0)
                    }
                }
            }
        }
    })

    function AddSure(){
        let schoolid = "{$schoolid}";
        let id = "{$_GPC['id']}";
        let bgimg = $("input[name=pageBackImg]").val();
        let thumb = $("input[name=thumb]").val();
        let pagetitle = $("#pagetitle").val();
        let pagetype = $("#pagetype").val();
        let ContainerData = {
            weid        :   "{$weid}",
            schoolid    :   "{$schoolid}",
            id          :   "{$_GPC['id']}",
            mid         :   "{$_GPC['mid']}",
            bgimg       :   bgimg,
            thumb       :   thumb,
            title       :   pagetitle,
            pagetype    :   pagetype,
            container   :   PageContainerList
        };
        $.post("{php echo $this->createWebUrl('indexajax',array('op'=>'SetMubanPage'))}", ContainerData, function(data) {
            alert(data.msg);
            location.reload()
        },'json');
    }
</script>


{template 'public/footer'}