{template 'public/header'}
{template 'public/comhead'}
<input type="hidden" name="schoolid" value="{$schoolid}" />
    <div class="panel panel-info">
        <div class="panel-body">
           {php echo $this -> set_tabbar2($action1, $schoolid);}
        </div>
    </div>
 <style>
.cLine { overflow: hidden; padding: 5px 0; color:#000000; }
.alert { padding: 8px 35px 0 10px; text-shadow: none; -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); background-color: #f9edbe; border: 1px solid #f0c36d; -webkit-border-radius: 2px; -moz-border-radius: 2px; border-radius: 2px; color: #333333; margin-top: 5px; }
.alert p { margin: 0 0 10px; display: block; }
.alert .bold{ font-weight:bold; }
.comment_item { padding-left: 50px; position: relative; min-height: 40px; margin: 0 0 40px; font-size: 12px; }
.comment_item img { width: 40px; height: 40px; position: absolute; left: 0; top: 10px; border-radius: 40px; }
.comment_item .n { color: #4C91FF; margin-bottom: 10px; }
.comment_item .c { font-size: 13px; color: #374F5E; margin-bottom: 9px; }
.comment_item .t { color: #91A0B2; }
.comment_tips { color: #AEC1D9; font-size: 11px; text-align: center; margin-bottom: 30px; }
.comment_item text { display: block; }
.weui_switchs:checked {border-color: #30c6e1;background-color: #30c6e1;}
.weui_switchs:checked:before {-webkit-transform: scale(0);transform: scale(0);}
.weui_switchs:checked:after {-webkit-transform: translateX(20px);transform: translateX(20px);}
.weui_switchs {font-size: 14px;-webkit-appearance: none;-moz-appearance: none;appearance: none;position: relative;width: 48px;height: 28px;border: 1px solid #DFDFDF;outline: 0;border-radius: 16px;box-sizing: border-box;background: #DFDFDF;vertical-align: middle;float: right;right: 12px;}
.weui_switchs:before {content: " ";position: absolute;top: 0;left: 0;width: 46px;height: 26px;border-radius: 15px;background-color: #FDFDFD;-webkit-transition: -webkit-transform .3s;transition: transform .3s;}
.weui_switchs:after {content: " ";position: absolute;top: 0;left: 0;width: 26px;height: 26px;border-radius: 15px;background-color: #FFFFFF;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);-webkit-transition: -webkit-transform .3s;transition: transform .3s;}
 </style>
<div class="cLine">
    <div class="alert">
    <p><span class="bold">说明：</span>
   此处的公告会出现在首页端，校长端发送公告并不会出现在这里，也不会出现在前端，此处的公告仅仅面向社会<br/>
   <strong><font color='red'>特别提醒: 此处公告可设置顺序显示或是否显示-(同步的文章仅限发布者编辑或删除)</font></strong>
    </p>
    </div>
</div>
{if $operation == 'post'}
<div class="panel panel-info">
    <div class="panel-heading"><a class="btn btn-primary" onclick="javascript :history.back(-1);"><i class="fa fa-tasks"></i> 返回文章列表</a></div>
</div>
<div class="clearfix">
	<div id="Layer2" style="display:none; background-color: gray;opacity:0.1;position:absolute; width:100%; height:100%; z-index:9999; padding-bottom: 20px; filter:Alpha(opacity=30)" >
	</div>
<form class="form-horizontal form" action="" method="post" enctype="multipart/form-data">
	<div class="panel panel-default">
		<div class="panel-heading">文章管理</div>
		<div class="panel-body">
				
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">排序</label>
					<div class="col-sm-8 col-xs-12">
						<input type="text" class="form-control" placeholder="" name="displayorder" value="{$item1['displayorder']}">
						<span class="help-block">文章的显示顺序，越大则越靠前</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">标题</label>
					<div class="col-sm-8 col-xs-12">
						<input type="text" class="form-control" placeholder="" name="title" value="{$item1['title']}">
					</div>
				</div>
				<div class="form-group ">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">是否开启评论</label>
					<div class="col-sm-2 col-xs-12">
						<label  class="radio-inline"><input type="radio" name="isopenpl" value="1" {if $item1['isopenpl'] == 0 ||$item1['isopenpl'] == 1}checked="true"{/if} /> 是</label>
						&nbsp;&nbsp;&nbsp;
						<label  class="radio-inline"><input type="radio" name="isopenpl" value="2" {if  $item1['isopenpl'] == 2}checked="true"{/if} /> 否</label>
						<span class="help-block">启用后就可以进行评论</span>
					</div>
				</div>
				<div class="form-group " id="defaultshow" {if $item1['isopenpl'] == 2}style="display:none;"{else}style="display:block;"{/if}>
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">默认显示评论</label>
					<div class="col-sm-2 col-xs-12">
						<label  class="radio-inline"><input type="radio" name="defaultshow" value="1" {if $item1['defaultshow'] == 0 || $item1['defaultshow'] == 1}checked="true"{/if} /> 是</label>
						&nbsp;&nbsp;&nbsp;
						<label  class="radio-inline"><input type="radio" name="defaultshow" value="2" {if  $item1['defaultshow'] == 2}checked="true"{/if} /> 否</label>
						<span class="help-block">启用后,自动显示评论</span>
					</div>
				</div>
				<div class="form-group ">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">是否开启点赞</label>
					<div class="col-sm-2 col-xs-12">
						<label  class="radio-inline"><input type="radio" name="isopendz" value="1" {if $item1['isopendz'] == 0 ||$item1['isopendz'] == 1}checked="true"{/if} /> 是</label>
						&nbsp;&nbsp;&nbsp;
						<label class="radio-inline"><input type="radio" name="isopendz" value="2" {if  $item1['isopendz'] == 2}checked="true"{/if} /> 否</label>
						<span class="help-block">启用后就可以进行点赞</span>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">文章作者</label>
					<div class="col-sm-8 col-xs-12">
						<input type="text" class="form-control" name="author" value="{$item1['author']}">
						<span class="help-block">留空显示本校名称</span>
					</div>
				</div>

				{if $_W['isfounder'] || $_W['role'] == 'owner'}
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">选择学校</label>
					<a class="col-sm-12 col-lg-8" style="color: #999;line-height: 35px;" onclick="opera(this)">展开学校列表</a>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label"></label>
					<div class="col-sm-12 col-lg-8" id="showAllSchool" style="display: none;">
						{loop $allSchool $it}
						{php $is = $this->uniarr($uniarr,$it['id']);}
						<label  class="checkbox-inline" style="width:20%;margin-left: 10px;line-height: 5px;">
							<input type="checkbox" name="schoolidstr[]" value="{$it['id']}" {if ($is)}checked="checked"{/if}>{$it['title']}
						</label>
						{/loop}
						<span class="help-block">此功能仅限公众号主管理员,创始人,副创始人有权使用</span>
					</div>
				</div>
				{/if}
				
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">缩略图</label>
					<div class="col-sm-8 col-xs-12">
						{php echo tpl_form_field_image('thumb', $item1['thumb'])}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
					<div class="col-sm-9 col-xs-12">
						<label>
						图片建议尺寸：90像素 * 70像素
						</label>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">分享描述</label>
					<div class="col-sm-8 col-xs-12">
						<textarea class="form-control" name="description" rows="5">{$item1['description']}</textarea>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">内容</label>
					<div class="col-sm-8 col-xs-12">
						{php echo tpl_ueditor('content', $item1['content']);}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">阅读次数</label>
					<div class="col-sm-8 col-xs-12">
						<input type="text" name="click" value="{$item1['click']}" class="form-control"/>
						<div class="help-block">默认为0。您可以设置一个初始值,阅读次数会在该初始值上增加。</div>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">点赞数</label>
					<div class="col-sm-8 col-xs-12">
						<input type="text" name="dianzan" value="{$item1['dianzan']}" class="form-control"/>
						<div class="help-block">默认为0。您可以设置一个初始值,点赞数会在该初始值上增加。</div>
					</div>
				</div>				
		</div>
	</div>
	<div class="form-group">
		<div class="col-sm-12">
			<input name="submit" type="submit" value="提交" class="btn btn-primary col-lg-1">
			<input type="hidden" name="token" value="{$_W['token']}" />
		</div>
	</div>
</form>
</div>

<script type="text/javascript">
	var show = 0;
	function opera(e){
		if(show == 0){
			$("#showAllSchool").show()
			$(e).html('关闭学校列表')
			show = 1;
		}else{
			$("#showAllSchool").hide()
			$(e).html('展开学校列表')
			show = 0;
		}
	}
	var category = {php echo json_encode($children)};
	$('#credit1').click(function(){
		$('#credit-status1').show();
	});
	$('#credit0').click(function(){
		$('#credit-status1').hide();
	});
	$('input[type=radio][name=isopenpl]').change(function () {
		var myvalue = $(this).val();
		if(myvalue == 1){
			$("#defaultshow").slideDown()
		}else{
			$("#defaultshow").slideUp()
		}
	});
</script>
{elseif $operation == 'display'}
<div class="panel panel-info">
	<div class="panel-heading">筛选</div>
	<div class="panel-body">
            <div class="form-group">
                <a class="btn btn-primary btn-sm qx_1422" href="{php echo $this->createWebUrl('wenzhang', array('op' => 'post', 'schoolid' => $schoolid))}">添加文章</a>
                <div class="form-group inline-form" style="display: inline-block;">
                    <form accept-charset="UTF-8" action="./index.php" class="form-inline" id="diandanbao/table_search" method="get" role="form">
                        <div style="margin:0;padding:0;display:inline">
                        <input name="utf8" type="hidden" value="✓"></div>
                        <input type="hidden" name="c" value="site" />
                        <input type="hidden" name="a" value="entry" />
                        <input type="hidden" name="m" value="fm_jiaoyu" />
                        <input type="hidden" name="do" value="wenzhang" />
						<input type="hidden" name="schoolid" value="{$schoolid}" />
                        <div class="form-group">
                            <label class="sr-only" for="q_name">标题(标题关键字)</label>
                            <input class="form-control" id="keyword" name="keyword" placeholder="标题(标题关键字)" type="search">
                        </div>
                        <input class="btn btn-sm btn-success" name="commit" type="submit" value="搜索">
                    </form>
                </div>
            </div>
	</div>
</div>

<div class="panel panel-default">
	<div class="table-responsive panel-body">
		<table class="table">
			<thead>
				<tr>
					<th style="width:50px">排序</th>
					<th>标题</th>
					<th style="width:80px;">点击量</th>
					<th style="width:80px;">点赞</th>
					<th style="width:80px;">缩略图</th>
					<th style="width:180px;">发布时间</th>
					<th style="width:180px;">作者</th>
					<th style="width:200px; text-align:right;">操作</th>
				</tr>
			</thead>
			<tbody>
				{loop $list $item}
				<tr>
					<td><span>{$item['displayorder']}</span></td>
					<td>
						<span class="label label-info"><i class="fa fa-list-alt"></i></span>&nbsp;{$item['title']}
					</td>
					<!-- {if $_W['isfounder'] || $_W['role'] == 'owner' || $ismaster['status'] == 2}
					<td>
						<input type="checkbox" value="{$item['isshow']}" data-id="{$item['id']}" name="isshow[]" {if $item['isshow'] == 0 || $item['isshow'] == 1}checked{/if}>
					</td>
					{else}
					<td>
						{if $item['isshow'] == 0 || $item['isshow'] == 1}
						<span class="label label-success"> 已审核 </span>
						{else}
						<span class="label label-danger"> 未审核 </span>
						{/if}
					</td>
					{/if} -->
					<td>
						<span class="label label-success"><i class="fa fa-rss">&nbsp;{$item['click']}</i></span>
					</td>
					<td>
						<span class="label label-danger"><i class="fa fa-gittip">&nbsp;{$item['dianzan']}</i></span>
					</td>					
					<td>
						{if !empty($item['thumb'])}<span class="label label-success">有</span>{else}
						<span class="label label-danger">无</span>{/if}
					</td>					
					<td>
						<span class="label label-success">{php echo date('Y-m-d H:i:s',$item['createtime'])}</span>
					</td>
					<td>
						{if empty($item['author'])}<span class="label label-success"><i class="fa fa-wechat"></i></span>&nbsp;无{else}&nbsp;
						<span class="label label-success"><i class="fa fa-wechat"></i></span><span class="label label-danger">{$item['author']}</span>{/if}
						{if $item['schoolid'] != $schoolid}
							<br>发布者:<span class="label label-success">{$item['name']}</span>
						{/if}
					</td>					
					<td style="text-align:right; position:relative;">
						{if $_W['isfounder'] || $_W['role'] == 'owner' || $ismaster['status'] == 2}
						<a  class="bj" href="{php echo $this->createWebUrl('article', array('op' => 'look', 'id' => $item['id'], 'schoolid' => $schoolid))}" title="查看">查看</a>
						{/if}
						
						{if $item['schoolid'] == $schoolid}
						&nbsp;-&nbsp;
						<a class="bj" id="qx_bj_ck" href="{php echo $this->createWebUrl('wenzhang', array('op' => 'post', 'id' => $item['id'], 'schoolid' => $schoolid))}" title="编辑">编辑</a>&nbsp;-&nbsp;
						<a class="qx_1423" class="qx_1423" onclick="return confirm('此操作不可恢复，确认吗？'); return false;" href="{php echo $this->createWebUrl('wenzhang', array('op' => 'delete', 'id' => $item['id'], 'schoolid' => $schoolid))}" title="删除">删除</a>
						{/if}
					</td>
				</tr>
				{/loop}
			</tbody>
		</table>
	</div>
</div>
{$pager}
{elseif $operation == 'look'}
<div class="panel panel-info">
	<div class="panel-heading"><a class="btn btn-primary" onclick="javascript :history.back(-1);">
		<i class="fa fa-tasks"></i> 返回</a>
	</div>
</div>
<div class="col-xs-12 col-sm-8 col-lg-8 ">
<form class="form-horizontal form" action="" method="post" enctype="multipart/form-data">
	<div class="panel panel-default">
		<div class="panel-heading">文章管理</div>
		<div class="panel-body">
			
			<div class="form-group">
				<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">标题</label>
				<div class="col-sm-8 col-xs-12">
					<input type="text" class="form-control" disabled value="{$item1['title']}">
				</div>
			</div>
			
			<div class="form-group">
				<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">分享描述</label>
				<div class="col-sm-8 col-xs-12">
					<textarea class="form-control" disabled style="resize: none;" rows="5">{$item1['description']}</textarea>
				</div>
			</div>

			<div class="form-group">
				<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">内容</label>
				<div class="col-sm-8 col-xs-12" >
					{php echo tpl_ueditor('content', $item1['content']);}
				</div>
			</div>

			<div class="form-group">
				<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">阅读次数</label>
				<div class="col-sm-8 col-xs-12">
					<input type="text" disabled value="{$item1['click']}" class="form-control"/>
				</div>
			</div>

			{if $item1['isopendz'] != 2}
			<div class="form-group">
				<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">点赞数</label>
				<div class="col-sm-8 col-xs-12">
					<input type="text" disabled value="{php echo count($articledz)}" class="form-control"/>
				</div>
			</div>
			{/if}
			{if $item1['isopenpl'] != 2}
			<div class="form-group">
				<label class="col-xs-12 col-sm-4 col-md-3 col-lg-2 control-label">评论数</label>
				<div class="col-sm-8 col-xs-12">
					<input type="text" disabled value="{php echo count($articlepl)}" class="form-control"/>
				</div>
			</div>
			{/if}
		</div>
	</div>
</form>
</div>

<div class="col-xs-12 col-sm-4 col-lg-4 " style="margin-top: 15px;">
	<div class="panel panel-info">
		<div class="panel-body">
			<div class="form-horizontal form">
				<div class="form-group" style="margin-bottom:1px;">
					<label class="col-sm-3 control-label" style="text-align: left;">点赞人员{php echo count($articledz)}</label>
				</div>
				<div class="form-group" style="padding: 20px;height:400px;overflow-y: scroll; display: flex; justify-content: start; flex-wrap: wrap;">
					{loop $articledz $item}
					<div style="padding-right: 20px;margin-bottom: 20px; text-align: center;">
						<img style="width:40px;height:40px;border-radius:50%;" src="{$item['avatar']}">
						<div>{$item['nickname']}</div>
					</div>
					{/loop}
				</div>
			</div>
		</div>
	</div>
	<div class="panel panel-info">
		<div class="panel-body">
			<div class="form-horizontal form">
				<div class="form-group" style="margin-bottom:1px;">
					<label class="col-sm-3 control-label" style="text-align: left;">文章评论{php echo count($articlepl)}</label>
				</div>
				<div class="form-group" style="padding: 20px;max-height: 450px;overflow-y: scroll;">
					<div class="comment_lsit">
						{loop $articlepl $row}						
						<div class="comment_item">
							<img src="{$row['avatar']}">
							<text class="n">{$row['nickname']}			
								<a style="margin-left:15px" onclick="opt_pl(`{$row['id']}`,'del',this)">删除</a>
								{if $row['status'] == 1}
								<span class="label label-success btn-xs pull-right">显示</span>
								{else}
								<span class="label label-warning btn-xs pull-right">隐藏</span>
								{/if}
								<input style="top:-10px;" class="weui_switchs" {if $row['status'] == 1}checked{/if} onclick="opt_pl(`{$row['id']}`,'hide',this)" type="checkbox">
							</text>
							<text class="c">{$row['content']}</text>
							<text class="t">{$row['createtime']}</text>
						</div>
						{/loop}
				<div class="comment_tips">
					<i>-</i>您可控制评论是否显示<i>-</i>
				</div>
	<script>
function opt_pl(id,type,elm){
	if(type == 'del'){//仅删除时显示提示
		if(!window.confirm('你确定要删除吗？')){
			return false;
		}
		var thisval = type;
	}else{
		var thisval = $(elm).prop('checked')?1:2;
		var word = $(elm).prop('checked')?"显示":"隐藏";
	}
	$.ajax({
		url: "{php echo $this->createWebUrl('indexajax', array('op'=>'opt_pl','schoolid'=>$schoolid,'weid'=>$weid))}",
		type: "post",
		dataType: "json",
		data: {
			id:id,
			type:thisval
		},
		success: function (data) {
			if(data.result){
				if(thisval == 'del'){ //仅删除时显示成功提示
					$(elm).parent().parent().hide(200)
					alert(data.msg)
				}
				if(thisval == 2){
					$(elm).prev().removeClass('label-success')
					$(elm).prev().addClass('label-warning')
					$(elm).prev().text(word)
				}
				if(thisval == 1){
					$(elm).prev().removeClass('label-warning')
					$(elm).prev().addClass('label-success')
					$(elm).prev().text(word)
				}				
			}else{
				alert(data.msg)
			}
		}		
	});
}
</script>	
							
</div>
				</div>
			</div>
		</div>
	</div>
</div>
{/if}
<script type="text/javascript">
$(function(){
	{if !(IsHasQx($tid_global,1001422,1,$schoolid))}
		$(".qx_1422").hide();
		$(".bj").attr("title","查看");
		$(".bj").html("查看");
		$("#Layer2").show();
		$("input[name=submit]").hide();
		
	{/if}
	{if !(IsHasQx($tid_global,1001423,1,$schoolid))}
		$(".qx_1423").hide();
	{/if}
});
// require(['jquery', 'util', 'bootstrap.switch'], function($, u){
// 	//学生与学生发送消息
// 	$(':checkbox[name="isshow[]"]').bootstrapSwitch();
// 	$(':checkbox[name="isshow[]"]').on('switchChange.bootstrapSwitch', function(e, state){
// 		var isshow = this.checked ? 1 : 2;
// 		var id = $(this).data('id');
// 		$.post("{php echo $this->createWebUrl('news', array('op' => 'change','schoolid' => $schoolid))}", {isshow: isshow, id:id}, function(resp){
// 			// alert(resp.msg)
// 		},'json');
// 	});
// });
</script>
{template 'public/footer'}
